‚óè Validation Warning:

  Unknown option "runInBand" with value true was found.
  This is probably a typing mistake. Fixing it will remove this message.

  Configuration Documentation:
  https://jestjs.io/docs/configuration

‚óè Validation Warning:

  Unknown option "runInBand" with value true was found.
  This is probably a typing mistake. Fixing it will remove this message.

  Configuration Documentation:
  https://jestjs.io/docs/configuration

ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[config] (WARN) 
    The "ts-jest" config option "isolatedModules" is deprecated and will be removed in v30.0.0. Please use "isolatedModules: true" in C:/FidiMyProjects2025/Software_Projects/AccuBooks/AccuBooks/backend/tsconfig.json instead, see https://www.typescriptlang.org/tsconfig/#isolatedModules
  
FAIL src/__tests__/integration/mail/mail.service.integration.test.ts (5.202 s)
  MailService Integration Tests
    sendMail
      √ó should send an email with template successfully (29 ms)
      ‚àö should throw an error for invalid template (5 ms)
      ‚àö should handle template compilation errors (64 ms)
      ‚àö should throw an error for invalid template (2 ms)
      ‚àö should handle template compilation errors (4 ms)
    compileTemplate
      ‚àö should compile template with context (8 ms)

  ‚óè MailService Integration Tests ‚Ä∫ sendMail ‚Ä∫ should send an email with template successfully

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 29 |[39m   [36masync[39m sendMail(to[33m:[39m string[33m,[39m subject[33m:[39m string[33m,[39m template[33m:[39m string[33m,[39m context[33m:[39m any) {
     [90m 30 |[39m     [36mconst[39m html [33m=[39m [36mthis[39m[33m.[39mcompileTemplate(template[33m,[39m context)[33m;[39m
    [31m[1m>[22m[39m[90m 31 |[39m     [36mawait[39m [36mthis[39m[33m.[39mtransporter[33m.[39msendMail({
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 32 |[39m       [36mfrom[39m[33m:[39m process[33m.[39menv[33m.[39m[33mSMTP_FROM[39m [33m||[39m [32m"no-reply@example.com"[39m[33m,[39m
     [90m 33 |[39m       to[33m,[39m
     [90m 34 |[39m       subject[33m,[39m[0m

      at new MimeNode (node_modules/nodemailer/lib/mime-node/index.js:45:74)
      at MailComposer._createContentNode (node_modules/nodemailer/lib/mail-composer/index.js:503:20)
      at MailComposer.compile (node_modules/nodemailer/lib/mail-composer/index.js:43:33)
      at node_modules/nodemailer/lib/mailer/index.js:187:56
      at processPlugins (node_modules/nodemailer/lib/mailer/index.js:291:28)
      at node_modules/nodemailer/lib/mailer/index.js:299:17
      at Mail._convertDataImages (node_modules/nodemailer/lib/mailer/index.js:403:20)
      at Mail._defaultPlugins.compile (node_modules/nodemailer/lib/mailer/index.js:31:41)
      at processPlugins (node_modules/nodemailer/lib/mailer/index.js:295:13)
      at Mail._processPlugins (node_modules/nodemailer/lib/mailer/index.js:303:9)
      at Mail.sendMail (node_modules/nodemailer/lib/mailer/index.js:173:14)
      at MailService.sendMail (src/mail/mail.service.ts:31:28)
      at Object.<anonymous> (src/__tests__/integration/mail/mail.service.integration.test.ts:126:25)

FAIL src/__tests__/refreshToken.service.test.ts
  RefreshTokenService
    generateRefreshToken
      √ó should generate a token of correct length (44 ms)
      √ó should generate different tokens each time (11 ms)
    hashToken
      √ó should hash a token consistently (9 ms)
      √ó should produce different hashes for different tokens (10 ms)
    createRefreshToken
      √ó should create a refresh token for user (9 ms)
      √ó should invalidate existing tokens when creating new one (12 ms)
      √ó should set correct expiry date (5 ms)
    verifyRefreshToken
      √ó should verify a valid token (8 ms)
      √ó should reject invalid token (8 ms)
      √ó should reject expired token (5 ms)
    rotateRefreshToken
      √ó should rotate a valid token (4 ms)
      √ó should reject rotation of invalid token (6 ms)
    invalidateUserRefreshTokens
      √ó should invalidate all user tokens (13 ms)
    invalidateRefreshToken
      √ó should invalidate specific token (9 ms)
      √ó should throw error for non-existent token (7 ms)
    cleanupExpiredTokens
      √ó should clean up expired tokens (5 ms)
      √ó should return 0 when no expired tokens exist (6 ms)
    getAccessTokenExpiry
      √ó should return correct expiry time (6 ms)
    getRefreshTokenExpiry
      √ó should return correct expiry time (5 ms)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate a token of correct length

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate a token of correct length

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate different tokens each time

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate different tokens each time

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should hash a token consistently

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should hash a token consistently

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should produce different hashes for different tokens

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should produce different hashes for different tokens

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should create a refresh token for user

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should create a refresh token for user

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should invalidate existing tokens when creating new one

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should invalidate existing tokens when creating new one

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should set correct expiry date

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should set correct expiry date

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should verify a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should verify a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject expired token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject expired token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should rotate a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should rotate a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should reject rotation of invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should reject rotation of invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ invalidateUserRefreshTokens ‚Ä∫ should invalidate all user tokens

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ invalidateUserRefreshTokens ‚Ä∫ should invalidate all user tokens

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should invalidate specific token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should invalidate specific token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should throw error for non-existent token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should throw error for non-existent token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should clean up expired tokens

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should clean up expired tokens

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should return 0 when no expired tokens exist

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should return 0 when no expired tokens exist

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ getAccessTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ getAccessTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ getRefreshTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ getRefreshTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

FAIL src/__tests__/auth.controller.simple.test.ts
  Auth Controller - Simple Tests
    login
      √ó should login user successfully (218 ms)
      ‚àö should handle validation errors (55 ms)
      √ó should handle authentication errors (47 ms)
    register
      √ó should register new user successfully (39 ms)
    refreshToken
      √ó should refresh access token successfully (53 ms)
      ‚àö should reject missing refresh token (51 ms)
    logout
      √ó should logout user successfully (59 ms)
    logoutAll
      √ó should logout from all sessions (37 ms)
      √ó should require authentication (45 ms)
    changePassword
      √ó should change password successfully (47 ms)
      √ó should require authentication (50 ms)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ login ‚Ä∫ should login user successfully

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:106:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ login ‚Ä∫ should handle authentication errors

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:177:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ register ‚Ä∫ should register new user successfully

    TypeError: req.get is not a function

    [0m [90m 224 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 225 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 226 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 227 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 228 |[39m       details[33m:[39m {
     [90m 229 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Registration failed"[39m[33m,[39m[0m

      at register (src/controllers/auth.controller.ts:226:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:212:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ refreshToken ‚Ä∫ should refresh access token successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 200

    Number of calls: 0

    [0m [90m 267 |[39m         mockRefreshToken[33m,[39m
     [90m 268 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 269 |[39m       expect(mockResponse[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([33mStatusCodes[39m[33m.[39m[33mOK[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 270 |[39m       expect(mockResponse[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m 271 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 272 |[39m         data[33m:[39m {[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:269:35)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ logout ‚Ä∫ should logout user successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-refresh-token"

    Number of calls: 0

    [0m [90m 318 |[39m       expect(
     [90m 319 |[39m         mockRefreshTokenService[33m.[39minvalidateRefreshToken[33m,[39m
    [31m[1m>[22m[39m[90m 320 |[39m       )[33m.[39mtoHaveBeenCalledWith(mockRefreshToken)[33m;[39m
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 321 |[39m       expect(mockResponse[33m.[39mclearCookie)[33m.[39mtoHaveBeenCalledWith(
     [90m 322 |[39m         [32m"refreshToken"[39m[33m,[39m
     [90m 323 |[39m         expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:320:9)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ logoutAll ‚Ä∫ should logout from all sessions

    TypeError: logoutAll is not a function

    [0m [90m 348 |[39m       )[33m;[39m
     [90m 349 |[39m
    [31m[1m>[22m[39m[90m 350 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 351 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 352 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 353 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:350:13)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ logoutAll ‚Ä∫ should require authentication

    TypeError: logoutAll is not a function

    [0m [90m 369 |[39m       mockRequest[33m.[39muser [33m=[39m undefined[33m;[39m
     [90m 370 |[39m
    [31m[1m>[22m[39m[90m 371 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 372 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 373 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 374 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:371:13)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ changePassword ‚Ä∫ should change password successfully

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:403:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ changePassword ‚Ä∫ should require authentication

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:432:13)

FAIL src/__tests__/refreshToken.service.unit.test.ts
  RefreshTokenService - Unit Tests
    generateRefreshToken
      √ó should generate a token of correct length (3 ms)
      √ó should generate different tokens each time (2 ms)
      √ó should generate tokens with only hex characters (3 ms)
    hashToken
      √ó should hash a token consistently (2 ms)
      √ó should produce different hashes for different tokens (2 ms)
      √ó should produce hash of correct length (2 ms)
    getAccessTokenExpiry
      ‚àö should return correct expiry time (2 ms)
    getRefreshTokenExpiry
      ‚àö should return correct expiry time (1 ms)
    Token Security
      √ó should not store plain tokens in database (1 ms)
      √ó should generate cryptographically secure tokens (1 ms)
    Error Handling
      √ó should handle database errors gracefully (5 ms)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ generateRefreshToken ‚Ä∫ should generate a token of correct length

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:51:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ generateRefreshToken ‚Ä∫ should generate different tokens each time

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:56:42)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ generateRefreshToken ‚Ä∫ should generate tokens with only hex characters

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:62:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ hashToken ‚Ä∫ should hash a token consistently

    TypeError: Cannot read properties of undefined (reading 'update')

    [0m [90m 21 |[39m [90m   */[39m
     [90m 22 |[39m   [36mstatic[39m hashToken(token[33m:[39m string)[33m:[39m string {
    [31m[1m>[22m[39m[90m 23 |[39m     [36mreturn[39m crypto[33m.[39mcreateHash([32m"sha256"[39m)[33m.[39mupdate(token)[33m.[39mdigest([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 24 |[39m   }
     [90m 25 |[39m
     [90m 26 |[39m   [90m/**[39m[0m

      at Function.hashToken (src/services/refreshToken.service.ts:23:39)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:70:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ hashToken ‚Ä∫ should produce different hashes for different tokens

    TypeError: Cannot read properties of undefined (reading 'update')

    [0m [90m 21 |[39m [90m   */[39m
     [90m 22 |[39m   [36mstatic[39m hashToken(token[33m:[39m string)[33m:[39m string {
    [31m[1m>[22m[39m[90m 23 |[39m     [36mreturn[39m crypto[33m.[39mcreateHash([32m"sha256"[39m)[33m.[39mupdate(token)[33m.[39mdigest([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 24 |[39m   }
     [90m 25 |[39m
     [90m 26 |[39m   [90m/**[39m[0m

      at Function.hashToken (src/services/refreshToken.service.ts:23:39)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:78:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ hashToken ‚Ä∫ should produce hash of correct length

    TypeError: Cannot read properties of undefined (reading 'update')

    [0m [90m 21 |[39m [90m   */[39m
     [90m 22 |[39m   [36mstatic[39m hashToken(token[33m:[39m string)[33m:[39m string {
    [31m[1m>[22m[39m[90m 23 |[39m     [36mreturn[39m crypto[33m.[39mcreateHash([32m"sha256"[39m)[33m.[39mupdate(token)[33m.[39mdigest([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 24 |[39m   }
     [90m 25 |[39m
     [90m 26 |[39m   [90m/**[39m[0m

      at Function.hashToken (src/services/refreshToken.service.ts:23:39)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:85:40)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ Token Security ‚Ä∫ should not store plain tokens in database

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:106:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ Token Security ‚Ä∫ should generate cryptographically secure tokens

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:117:40)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ Error Handling ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to create refresh token"
    Received message:   "Cannot read properties of undefined (reading 'toString')"

        [0m [90m 14 |[39m [90m   */[39m
         [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
        [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
         [90m    |[39m                                  [31m[1m^[22m[39m
         [90m 17 |[39m   }
         [90m 18 |[39m
         [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Function.createRefreshToken (src/services/refreshToken.service.ts:33:24)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:130:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:130:71)

FAIL src/__tests__/business-logic/bookkeeping.rules.test.ts
  Bookkeeping Rules
    validateDoubleEntry
      √ó should validate a balanced transaction (32 ms)
      √ó should reject transaction with less than 2 entries (10 ms)
      √ó should reject entry that is both debit and credit (6 ms)
      √ó should reject unbalanced transaction (5 ms)
      √ó should reject entry that is both debit and credit (11 ms)
      √ó should reject entry that is neither debit nor credit (9 ms)
      √ó should reject zero or negative amounts (5 ms)
    createTransferTransaction
      √ó should create a valid transfer transaction (1 ms)
    createFeeTransaction
      √ó should create a valid fee transaction (1 ms)
    createInterestTransaction
      √ó should create a valid interest transaction (1 ms)
    calculateBalance
      √ó should calculate account balance correctly (1 ms)
      √ó should handle account with no entries (1 ms)
    validateAccountConstraints
      √ó should allow valid transaction (7 ms)
      √ó should reject insufficient funds in checking account (5 ms)
      √ó should reject negative balance in savings account (6 ms)
    reverseTransaction
      √ó should create reversing transaction
    validateTrialBalance
      √ó should validate balanced trial balance (5 ms)
      √ó should reject unbalanced trial balance (8 ms)
    createAdjustingEntry
      √ó should create adjusting entry with clearing account (1 ms)
  TransactionTemplates
    bankTransfer
      √ó should create bank transfer transaction
    atmWithdrawal
      √ó should create ATM withdrawal with fee (1 ms)
    interestBearingDeposit
      √ó should create deposit with interest (1 ms)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should validate a balanced transaction

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 40 |[39m
         [90m 41 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 42 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction)[33m,[39m
         [90m    |[39m                          [31m[1m^[22m[39m
         [90m 43 |[39m       )[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
         [90m 44 |[39m     })[33m;[39m
         [90m 45 |[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:42:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:43:13)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:43:13)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject transaction with less than 2 entries

    expect(received).toThrow(expected)

    Expected substring: "Transaction must have at least 2 entries"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 66 |[39m       }[33m;[39m
         [90m 67 |[39m
        [31m[1m>[22m[39m[90m 68 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m    |[39m                                     [31m[1m^[22m[39m
         [90m 69 |[39m         [32m"Transaction must have at least 2 entries"[39m[33m,[39m
         [90m 70 |[39m       )[33m;[39m
         [90m 71 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:68:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:68:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:68:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject entry that is both debit and credit

    expect(received).toThrow(expected)

    Expected substring: "Entry cannot be both debit and credit"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 115 |[39m       }[33m;[39m
         [90m 116 |[39m
        [31m[1m>[22m[39m[90m 117 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 118 |[39m         [32m"Entry cannot be both debit and credit"[39m[33m,[39m
         [90m 119 |[39m       )[33m;[39m
         [90m 120 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:117:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:117:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:117:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject unbalanced transaction

    expect(received).toThrow(expected)

    Expected substring: "Transaction is not balanced"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 153 |[39m       }[33m;[39m
         [90m 154 |[39m
        [31m[1m>[22m[39m[90m 155 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 156 |[39m         [32m"Transaction is not balanced"[39m[33m,[39m
         [90m 157 |[39m       )[33m;[39m
         [90m 158 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:155:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:155:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:155:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject entry that is both debit and credit

    expect(received).toThrow(expected)

    Expected substring: "Transaction is not balanced. Debits: 100, Credits: 200"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 191 |[39m       }[33m;[39m
         [90m 192 |[39m
        [31m[1m>[22m[39m[90m 193 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 194 |[39m         [32m"Transaction is not balanced. Debits: 100, Credits: 200"[39m[33m,[39m
         [90m 195 |[39m       )[33m;[39m
         [90m 196 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:193:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:193:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:193:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject entry that is neither debit nor credit

    expect(received).toThrow(expected)

    Expected substring: "Transaction is not balanced. Debits: 0, Credits: 100"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 229 |[39m       }[33m;[39m
         [90m 230 |[39m
        [31m[1m>[22m[39m[90m 231 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 232 |[39m         [32m"Transaction is not balanced. Debits: 0, Credits: 100"[39m[33m,[39m
         [90m 233 |[39m       )[33m;[39m
         [90m 234 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:231:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:231:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:231:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject zero or negative amounts

    expect(received).toThrow(expected)

    Expected substring: "Entry amounts must be positive"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 267 |[39m       }[33m;[39m
         [90m 268 |[39m
        [31m[1m>[22m[39m[90m 269 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 270 |[39m         [32m"Entry amounts must be positive"[39m[33m,[39m
         [90m 271 |[39m       )[33m;[39m
         [90m 272 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:269:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:269:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:269:71)

  ‚óè Bookkeeping Rules ‚Ä∫ createTransferTransaction ‚Ä∫ should create a valid transfer transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.createTransferTransaction is not a function

    [0m [90m 275 |[39m   describe([32m"createTransferTransaction"[39m[33m,[39m () [33m=>[39m {
     [90m 276 |[39m     it([32m"should create a valid transfer transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 277 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateTransferTransaction(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 278 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 279 |[39m         [32m"acc2"[39m[33m,[39m
     [90m 280 |[39m         [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:277:44)

  ‚óè Bookkeeping Rules ‚Ä∫ createFeeTransaction ‚Ä∫ should create a valid fee transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.createFeeTransaction is not a function

    [0m [90m 310 |[39m   describe([32m"createFeeTransaction"[39m[33m,[39m () [33m=>[39m {
     [90m 311 |[39m     it([32m"should create a valid fee transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 312 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateFeeTransaction(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 313 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 314 |[39m         [35m5.5[39m[33m,[39m
     [90m 315 |[39m         [32m"fee-revenue"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:312:44)

  ‚óè Bookkeeping Rules ‚Ä∫ createInterestTransaction ‚Ä∫ should create a valid interest transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.createInterestTransaction is not a function

    [0m [90m 335 |[39m   describe([32m"createInterestTransaction"[39m[33m,[39m () [33m=>[39m {
     [90m 336 |[39m     it([32m"should create a valid interest transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 337 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateInterestTransaction(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 338 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 339 |[39m         [35m10.0[39m[33m,[39m
     [90m 340 |[39m         [32m"interest-payable"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:337:44)

  ‚óè Bookkeeping Rules ‚Ä∫ calculateBalance ‚Ä∫ should calculate account balance correctly

    TypeError: bookkeeping_rules_1.BookkeepingRules.calculateBalance is not a function

    [0m [90m 396 |[39m       ][33m;[39m
     [90m 397 |[39m
    [31m[1m>[22m[39m[90m 398 |[39m       [36mconst[39m balance [33m=[39m [33mBookkeepingRules[39m[33m.[39mcalculateBalance(entries[33m,[39m [32m"acc1"[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 399 |[39m
     [90m 400 |[39m       expect(balance[33m.[39maccountId)[33m.[39mtoBe([32m"acc1"[39m)[33m;[39m
     [90m 401 |[39m       expect(balance[33m.[39mdebitBalance)[33m.[39mtoBe([35m100[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:398:40)

  ‚óè Bookkeeping Rules ‚Ä∫ calculateBalance ‚Ä∫ should handle account with no entries

    TypeError: bookkeeping_rules_1.BookkeepingRules.calculateBalance is not a function

    [0m [90m 406 |[39m     it([32m"should handle account with no entries"[39m[33m,[39m () [33m=>[39m {
     [90m 407 |[39m       [36mconst[39m entries [33m=[39m [][33m;[39m
    [31m[1m>[22m[39m[90m 408 |[39m       [36mconst[39m balance [33m=[39m [33mBookkeepingRules[39m[33m.[39mcalculateBalance(entries[33m,[39m [32m"acc1"[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 409 |[39m
     [90m 410 |[39m       expect(balance[33m.[39mdebitBalance)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 411 |[39m       expect(balance[33m.[39mcreditBalance)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:408:40)

  ‚óè Bookkeeping Rules ‚Ä∫ validateAccountConstraints ‚Ä∫ should allow valid transaction

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "bookkeeping_rules_1.BookkeepingRules.validateAccountConstraints is not a function"

        [0m [90m 477 |[39m
         [90m 478 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 479 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateAccountConstraints(
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 480 |[39m           transaction[33m,[39m
         [90m 481 |[39m           accountBalances[33m,[39m
         [90m 482 |[39m           accountTypes[33m,[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:479:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:484:13)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:484:13)

  ‚óè Bookkeeping Rules ‚Ä∫ validateAccountConstraints ‚Ä∫ should reject insufficient funds in checking account

    expect(received).toThrow(expected)

    Expected substring: "Overdraft limit exceeded for account acc1"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateAccountConstraints is not a function"

        [0m [90m 547 |[39m
         [90m 548 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 549 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateAccountConstraints(
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 550 |[39m           transaction[33m,[39m
         [90m 551 |[39m           accountBalances[33m,[39m
         [90m 552 |[39m           accountTypes[33m,[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:549:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:554:9)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:554:9)

  ‚óè Bookkeeping Rules ‚Ä∫ validateAccountConstraints ‚Ä∫ should reject negative balance in savings account

    expect(received).toThrow(expected)

    Expected substring: "Insufficient funds in savings account acc1"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateAccountConstraints is not a function"

        [0m [90m 617 |[39m
         [90m 618 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 619 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateAccountConstraints(
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 620 |[39m           transaction[33m,[39m
         [90m 621 |[39m           accountBalances[33m,[39m
         [90m 622 |[39m           accountTypes[33m,[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:619:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:624:9)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:624:9)

  ‚óè Bookkeeping Rules ‚Ä∫ reverseTransaction ‚Ä∫ should create reversing transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.reverseTransaction is not a function

    [0m [90m 660 |[39m       }[33m;[39m
     [90m 661 |[39m
    [31m[1m>[22m[39m[90m 662 |[39m       [36mconst[39m reversal [33m=[39m [33mBookkeepingRules[39m[33m.[39mreverseTransaction(
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 663 |[39m         originalTransaction[33m,[39m
     [90m 664 |[39m         [32m"Customer request"[39m[33m,[39m
     [90m 665 |[39m         [32m"user1"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:662:41)

  ‚óè Bookkeeping Rules ‚Ä∫ validateTrialBalance ‚Ä∫ should validate balanced trial balance

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "bookkeeping_rules_1.BookkeepingRules.validateTrialBalance is not a function"

        [0m [90m 706 |[39m
         [90m 707 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 708 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateTrialBalance(accountBalances)[33m,[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 709 |[39m       )[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
         [90m 710 |[39m     })[33m;[39m
         [90m 711 |[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:708:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:709:13)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:709:13)

  ‚óè Bookkeeping Rules ‚Ä∫ validateTrialBalance ‚Ä∫ should reject unbalanced trial balance

    expect(received).toThrow(expected)

    Expected substring: "Trial balance is not balanced"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateTrialBalance is not a function"

        [0m [90m 729 |[39m
         [90m 730 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 731 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateTrialBalance(accountBalances)[33m,[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 732 |[39m       )[33m.[39mtoThrow([32m"Trial balance is not balanced"[39m)[33m;[39m
         [90m 733 |[39m     })[33m;[39m
         [90m 734 |[39m   })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:731:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:732:9)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:732:9)

  ‚óè Bookkeeping Rules ‚Ä∫ createAdjustingEntry ‚Ä∫ should create adjusting entry with clearing account

    TypeError: bookkeeping_rules_1.BookkeepingRules.createAdjustingEntry is not a function

    [0m [90m 736 |[39m   describe([32m"createAdjustingEntry"[39m[33m,[39m () [33m=>[39m {
     [90m 737 |[39m     it([32m"should create adjusting entry with clearing account"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 738 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateAdjustingEntry(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 739 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 740 |[39m         [35m100[39m[33m,[39m
     [90m 741 |[39m         [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:738:44)

  ‚óè TransactionTemplates ‚Ä∫ bankTransfer ‚Ä∫ should create bank transfer transaction

    TypeError: Cannot read properties of undefined (reading 'bankTransfer')

    [0m [90m 768 |[39m   describe([32m"bankTransfer"[39m[33m,[39m () [33m=>[39m {
     [90m 769 |[39m     it([32m"should create bank transfer transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 770 |[39m       [36mconst[39m txn [33m=[39m [33mTransactionTemplates[39m[33m.[39mbankTransfer(
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 771 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 772 |[39m         [32m"acc2"[39m[33m,[39m
     [90m 773 |[39m         [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:770:40)

  ‚óè TransactionTemplates ‚Ä∫ atmWithdrawal ‚Ä∫ should create ATM withdrawal with fee

    TypeError: Cannot read properties of undefined (reading 'atmWithdrawal')

    [0m [90m 784 |[39m   describe([32m"atmWithdrawal"[39m[33m,[39m () [33m=>[39m {
     [90m 785 |[39m     it([32m"should create ATM withdrawal with fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 786 |[39m       [36mconst[39m result [33m=[39m [33mTransactionTemplates[39m[33m.[39matmWithdrawal(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 787 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 788 |[39m         [35m100[39m[33m,[39m
     [90m 789 |[39m         [35m2.5[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:786:43)

  ‚óè TransactionTemplates ‚Ä∫ interestBearingDeposit ‚Ä∫ should create deposit with interest

    TypeError: Cannot read properties of undefined (reading 'interestBearingDeposit')

    [0m [90m 801 |[39m   describe([32m"interestBearingDeposit"[39m[33m,[39m () [33m=>[39m {
     [90m 802 |[39m     it([32m"should create deposit with interest"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 803 |[39m       [36mconst[39m result [33m=[39m [33mTransactionTemplates[39m[33m.[39minterestBearingDeposit(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 804 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 805 |[39m         [35m1000[39m[33m,[39m
     [90m 806 |[39m         [35m5.0[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:803:43)

FAIL src/__tests__/auth-service.test.ts
  AuthService
    register
      √ó should register a new user successfully (4 ms)
      √ó should throw an error if user already exists (8 ms)
    login
      √ó should login a user with valid credentials (3 ms)
      √ó should throw an error for invalid credentials (5 ms)
    getCurrentUser
      √ó should return the current user (9 ms)
      ‚àö should throw an error if user is not found (1 ms)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should register a new user successfully

    TypeError: Cannot read properties of undefined (reading 'create')

    [0m [90m 86 |[39m   expiresAt[33m.[39msetSeconds(expiresAt[33m.[39mgetSeconds() [33m+[39m [33mREFRESH_TOKEN_EXPIRES_IN[39m)[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m   [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mcreate({
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 89 |[39m     data[33m:[39m {
     [90m 90 |[39m       tokenHash[33m:[39m token[33m,[39m [90m// Store the token as hash[39m
     [90m 91 |[39m       userId[33m,[39m[0m

      at generateRefreshToken (src/services/auth.service.ts:88:29)
      at AuthService.generateAuthTokens (src/services/auth.service.ts:211:7)
      at AuthService.register (src/services/auth.service.ts:137:31)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:74:22)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should throw an error if user already exists

    expect(received).rejects.toThrow(expected)

    Expected substring: "User already exists"
    Received message:   "Email is already registered"

        [0m [90m 113 |[39m
         [90m 114 |[39m     [36mif[39m (existingUser) {
        [31m[1m>[22m[39m[90m 115 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m(
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 116 |[39m         [33mStatusCodes[39m[33m.[39m[33mBAD_REQUEST[39m[33m,[39m
         [90m 117 |[39m         [32m"Email is already registered"[39m[33m,[39m
         [90m 118 |[39m       )[33m;[39m[0m

      at AuthService.register (src/services/auth.service.ts:115:13)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:105:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:105:60)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should login a user with valid credentials

    TypeError: Cannot read properties of undefined (reading 'create')

    [0m [90m 86 |[39m   expiresAt[33m.[39msetSeconds(expiresAt[33m.[39mgetSeconds() [33m+[39m [33mREFRESH_TOKEN_EXPIRES_IN[39m)[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m   [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mcreate({
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 89 |[39m     data[33m:[39m {
     [90m 90 |[39m       tokenHash[33m:[39m token[33m,[39m [90m// Store the token as hash[39m
     [90m 91 |[39m       userId[33m,[39m[0m

      at generateRefreshToken (src/services/auth.service.ts:88:29)
      at AuthService.generateAuthTokens (src/services/auth.service.ts:211:7)
      at AuthService.login (src/services/auth.service.ts:174:31)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:133:22)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should throw an error for invalid credentials

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid credentials"
    Received message:   "Invalid email or password"

        [0m [90m 168 |[39m     )[33m;[39m
         [90m 169 |[39m     [36mif[39m ([33m![39misPasswordValid) {
        [31m[1m>[22m[39m[90m 170 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([33mStatusCodes[39m[33m.[39m[33mUNAUTHORIZED[39m[33m,[39m [32m"Invalid email or password"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 171 |[39m     }
         [90m 172 |[39m
         [90m 173 |[39m     [90m// Generate tokens[39m[0m

      at AuthService.login (src/services/auth.service.ts:170:13)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:167:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:167:60)

  ‚óè AuthService ‚Ä∫ getCurrentUser ‚Ä∫ should return the current user

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    @@ -1,11 +1,14 @@
      Object {
        "select": Object {
          "createdAt": true,
          "email": true,
          "id": true,
    +     "isActive": true,
    +     "lastLogin": true,
          "name": true,
    +     "passwordChangedAt": true,
          "role": true,
          "updatedAt": true,
        },
        "where": Object {
          "id": 1,,

    Number of calls: 1

    [0m [90m 200 |[39m
     [90m 201 |[39m       [90m// Assert[39m
    [31m[1m>[22m[39m[90m 202 |[39m       expect(mockFindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 203 |[39m         where[33m:[39m { id[33m:[39m userId }[33m,[39m
     [90m 204 |[39m         select[33m:[39m {
     [90m 205 |[39m           id[33m:[39m [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth-service.test.ts:202:30)

FAIL src/__tests__/auth.controller.unit.test.ts
  Auth Controller - Unit Tests
    login
      √ó should login user and set refresh token cookie (3 ms)
      √ó should handle login failure (3 ms)
      ‚àö should validate request body (3 ms)
    register
      √ó should register new user and set refresh token cookie (2 ms)
    refreshToken
      √ó should refresh access token with valid refresh token (2 ms)
      ‚àö should reject missing refresh token (2 ms)
      ‚àö should handle refresh token failure and clear cookie (1 ms)
    logout
      √ó should logout user and clear refresh token (1 ms)
      ‚àö should handle logout without refresh token (1 ms)
    logoutAll
      √ó should logout user from all sessions (1 ms)
      √ó should require authentication (6 ms)
    changePassword
      √ó should change password and invalidate all refresh tokens (2 ms)
      √ó should require authentication (1 ms)
      √ó should validate password format (1 ms)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ login ‚Ä∫ should login user and set refresh token cookie

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:108:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ login ‚Ä∫ should handle login failure

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:157:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ register ‚Ä∫ should register new user and set refresh token cookie

    TypeError: req.get is not a function

    [0m [90m 224 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 225 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 226 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 227 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 228 |[39m       details[33m:[39m {
     [90m 229 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Registration failed"[39m[33m,[39m[0m

      at register (src/controllers/auth.controller.ts:226:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:209:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ refreshToken ‚Ä∫ should refresh access token with valid refresh token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"email": "test@example.com", "id": 1, "role": "USER"}

    Number of calls: 0

    [0m [90m 264 |[39m         mockNewRefreshToken[33m,[39m
     [90m 265 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 266 |[39m       expect(mockAuthService[33m.[39mgenerateAccessToken)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 267 |[39m         mockUser[33m,[39m
     [90m 268 |[39m       )[33m;[39m
     [90m 269 |[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:266:51)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ logout ‚Ä∫ should logout user and clear refresh token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-refresh-token"

    Number of calls: 0

    [0m [90m 352 |[39m       expect(
     [90m 353 |[39m         mockRefreshTokenService[33m.[39minvalidateRefreshToken[33m,[39m
    [31m[1m>[22m[39m[90m 354 |[39m       )[33m.[39mtoHaveBeenCalledWith(mockRefreshToken)[33m;[39m
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 355 |[39m       expect(mockResponse[33m.[39mclearCookie)[33m.[39mtoHaveBeenCalledWith(
     [90m 356 |[39m         [32m"refreshToken"[39m[33m,[39m
     [90m 357 |[39m         expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:354:9)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ logoutAll ‚Ä∫ should logout user from all sessions

    TypeError: logoutAll is not a function

    [0m [90m 395 |[39m       )[33m;[39m
     [90m 396 |[39m
    [31m[1m>[22m[39m[90m 397 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 398 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 399 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 400 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:397:13)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ logoutAll ‚Ä∫ should require authentication

    TypeError: logoutAll is not a function

    [0m [90m 424 |[39m       mockRequest[33m.[39muser [33m=[39m undefined[33m;[39m
     [90m 425 |[39m
    [31m[1m>[22m[39m[90m 426 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 427 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 428 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 429 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:426:13)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ changePassword ‚Ä∫ should change password and invalidate all refresh tokens

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:454:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ changePassword ‚Ä∫ should require authentication

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:489:13)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ changePassword ‚Ä∫ should validate password format

    Validation failed

    [0m [90m 358 |[39m   } [36mcatch[39m (error) {
     [90m 359 |[39m     [36mif[39m (error [36minstanceof[39m z[33m.[39m[33mZodError[39m) {
    [31m[1m>[22m[39m[90m 360 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 361 |[39m         [32m"Validation failed"[39m[33m,[39m
     [90m 362 |[39m         [33mStatusCodes[39m[33m.[39m[33mBAD_REQUEST[39m[33m,[39m
     [90m 363 |[39m         [33mErrorCodes[39m[33m.[39m[33mVALIDATION_ERROR[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:360:13)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:510:13)

FAIL src/__tests__/business-logic/financial.calculator.test.ts
  Financial Calculator
    convertCurrency
      √ó should convert currency correctly (1 ms)
      √ó should round to correct precision (1 ms)
      √ó should reject negative amounts (7 ms)
      √ó should reject zero or negative exchange rate (9 ms)
    calculateTax
      √ó should calculate tax correctly (1 ms)
      √ó should handle zero tax rate (1 ms)
      √ó should reject negative amounts (6 ms)
      √ó should reject tax rate outside 0-1 range (7 ms)
    calculateInterest
      √ó should calculate compound interest correctly (2 ms)
      √ó should calculate simple interest correctly (2 ms)
      √ó should reject negative parameters (8 ms)
    calculateBalanceSummary
      √ó should calculate balance summary correctly (1 ms)
      √ó should handle zero pending amounts (1 ms)
    calculateTransactionFee
      √ó should calculate fixed fee only (1 ms)
      √ó should calculate percentage fee only (1 ms)
      √ó should calculate combined fee (1 ms)
      √ó should apply minimum fee (1 ms)
      √ó should apply maximum fee (1 ms)
    calculateConversionWithSpread
      √ó should calculate conversion with spread (1 ms)
    calculateMonthlyPayment
      √ó should calculate loan payment correctly (1 ms)
      √ó should handle zero interest loan
      √ó should reject invalid parameters (3 ms)
    calculateAmortizationSchedule
      √ó should generate amortization schedule (1 ms)
    calculateNPV
      √ó should calculate NPV correctly (1 ms)
    calculateIRR
      √ó should calculate IRR correctly (2 ms)
      √ó should throw if IRR calculation fails to converge (4 ms)
  FinancialCalculations
    convertCurrency
      √ó should be an alias to FinancialCalculator.convertCurrency (2 ms)
    calculateTotalWithFees
      √ó should calculate total with fees (2 ms)
      √ó should handle no fees (2 ms)
    calculateLoanDetails
      √ó should provide complete loan details (1 ms)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should convert currency correctly

    TypeError: financial_calculator_1.FinancialCalculator.convertCurrency is not a function

    [0m [90m  7 |[39m   describe([32m"convertCurrency"[39m[33m,[39m () [33m=>[39m {
     [90m  8 |[39m     it([32m"should convert currency correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m  9 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mconvertCurrency(
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 10 |[39m         [35m100[39m[33m,[39m
     [90m 11 |[39m         [32m"USD"[39m[33m,[39m
     [90m 12 |[39m         [32m"EUR"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:9:42)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should round to correct precision

    TypeError: financial_calculator_1.FinancialCalculator.convertCurrency is not a function

    [0m [90m 17 |[39m
     [90m 18 |[39m     it([32m"should round to correct precision"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 19 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mconvertCurrency(
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 20 |[39m         [35m100[39m[33m,[39m
     [90m 21 |[39m         [32m"USD"[39m[33m,[39m
     [90m 22 |[39m         [32m"JPY"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:19:42)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should reject negative amounts

    expect(received).toThrow(expected)

    Expected substring: "Cannot convert negative amounts"
    Received message:   "financial_calculator_1.FinancialCalculator.convertCurrency is not a function"

        [0m [90m 28 |[39m     it([32m"should reject negative amounts"[39m[33m,[39m () [33m=>[39m {
         [90m 29 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 30 |[39m         [33mFinancialCalculator[39m[33m.[39mconvertCurrency([33m-[39m[35m100[39m[33m,[39m [32m"USD"[39m[33m,[39m [32m"EUR"[39m[33m,[39m [35m0.85[39m)[33m,[39m
         [90m    |[39m                             [31m[1m^[22m[39m
         [90m 31 |[39m       )[33m.[39mtoThrow([32m"Cannot convert negative amounts"[39m)[33m;[39m
         [90m 32 |[39m     })[33m;[39m
         [90m 33 |[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:30:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:31:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:31:9)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should reject zero or negative exchange rate

    expect(received).toThrow(expected)

    Expected substring: "Exchange rate must be positive"
    Received message:   "financial_calculator_1.FinancialCalculator.convertCurrency is not a function"

        [0m [90m 34 |[39m     it([32m"should reject zero or negative exchange rate"[39m[33m,[39m () [33m=>[39m {
         [90m 35 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 36 |[39m         [33mFinancialCalculator[39m[33m.[39mconvertCurrency([35m100[39m[33m,[39m [32m"USD"[39m[33m,[39m [32m"EUR"[39m[33m,[39m [35m0[39m)[33m,[39m
         [90m    |[39m                             [31m[1m^[22m[39m
         [90m 37 |[39m       )[33m.[39mtoThrow([32m"Exchange rate must be positive"[39m)[33m;[39m
         [90m 38 |[39m
         [90m 39 |[39m       expect(() [33m=>[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:36:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:37:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:37:9)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should calculate tax correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateTax is not a function

    [0m [90m 45 |[39m   describe([32m"calculateTax"[39m[33m,[39m () [33m=>[39m {
     [90m 46 |[39m     it([32m"should calculate tax correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 47 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([35m100[39m[33m,[39m [35m0.08[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 48 |[39m       expect(result)[33m.[39mtoEqual({
     [90m 49 |[39m         amount[33m:[39m [35m100[39m[33m,[39m
     [90m 50 |[39m         taxRate[33m:[39m [35m0.08[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:47:42)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should handle zero tax rate

    TypeError: financial_calculator_1.FinancialCalculator.calculateTax is not a function

    [0m [90m 56 |[39m
     [90m 57 |[39m     it([32m"should handle zero tax rate"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 58 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([35m100[39m[33m,[39m [35m0[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 59 |[39m       expect(result)[33m.[39mtoEqual({
     [90m 60 |[39m         amount[33m:[39m [35m100[39m[33m,[39m
     [90m 61 |[39m         taxRate[33m:[39m [35m0[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:58:42)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should reject negative amounts

    expect(received).toThrow(expected)

    Expected substring: "Cannot calculate tax on negative amount"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateTax is not a function"

        [0m [90m 67 |[39m
         [90m 68 |[39m     it([32m"should reject negative amounts"[39m[33m,[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 69 |[39m       expect(() [33m=>[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([33m-[39m[35m100[39m[33m,[39m [35m0.08[39m))[33m.[39mtoThrow(
         [90m    |[39m                                        [31m[1m^[22m[39m
         [90m 70 |[39m         [32m"Cannot calculate tax on negative amount"[39m[33m,[39m
         [90m 71 |[39m       )[33m;[39m
         [90m 72 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:69:40
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:69:66)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:69:66)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should reject tax rate outside 0-1 range

    expect(received).toThrow(expected)

    Expected substring: "Tax rate must be between 0 and 1 (0-100%)"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateTax is not a function"

        [0m [90m 73 |[39m
         [90m 74 |[39m     it([32m"should reject tax rate outside 0-1 range"[39m[33m,[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 75 |[39m       expect(() [33m=>[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([35m100[39m[33m,[39m [33m-[39m[35m0.1[39m))[33m.[39mtoThrow(
         [90m    |[39m                                        [31m[1m^[22m[39m
         [90m 76 |[39m         [32m"Tax rate must be between 0 and 1 (0-100%)"[39m[33m,[39m
         [90m 77 |[39m       )[33m;[39m
         [90m 78 |[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:75:40
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:75:65)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:75:65)

  ‚óè Financial Calculator ‚Ä∫ calculateInterest ‚Ä∫ should calculate compound interest correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateInterest is not a function

    [0m [90m 85 |[39m   describe([32m"calculateInterest"[39m[33m,[39m () [33m=>[39m {
     [90m 86 |[39m     it([32m"should calculate compound interest correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 87 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateInterest(
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 88 |[39m         [35m1000[39m[33m,[39m
     [90m 89 |[39m         [35m0.05[39m[33m,[39m
     [90m 90 |[39m         [35m365[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:87:42)

  ‚óè Financial Calculator ‚Ä∫ calculateInterest ‚Ä∫ should calculate simple interest correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateSimpleInterest is not a function

    [0m [90m  96 |[39m
     [90m  97 |[39m     it([32m"should calculate simple interest correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m  98 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateSimpleInterest(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m  99 |[39m         [35m1000[39m[33m,[39m
     [90m 100 |[39m         [35m0.05[39m[33m,[39m
     [90m 101 |[39m         [35m365[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:98:42)

  ‚óè Financial Calculator ‚Ä∫ calculateInterest ‚Ä∫ should reject negative parameters

    expect(received).toThrow(expected)

    Expected substring: "Principal cannot be negative"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateInterest is not a function"

        [0m [90m 107 |[39m     it([32m"should reject negative parameters"[39m[33m,[39m () [33m=>[39m {
         [90m 108 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 109 |[39m         [33mFinancialCalculator[39m[33m.[39mcalculateInterest([33m-[39m[35m1000[39m[33m,[39m [35m0.05[39m[33m,[39m [35m365[39m)[33m,[39m
         [90m     |[39m                             [31m[1m^[22m[39m
         [90m 110 |[39m       )[33m.[39mtoThrow([32m"Principal cannot be negative"[39m)[33m;[39m
         [90m 111 |[39m
         [90m 112 |[39m       expect(() [33m=>[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:109:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:110:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:110:9)

  ‚óè Financial Calculator ‚Ä∫ calculateBalanceSummary ‚Ä∫ should calculate balance summary correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateBalanceSummary is not a function

    [0m [90m 122 |[39m   describe([32m"calculateBalanceSummary"[39m[33m,[39m () [33m=>[39m {
     [90m 123 |[39m     it([32m"should calculate balance summary correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 124 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateBalanceSummary(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 125 |[39m         [35m1000[39m[33m,[39m
     [90m 126 |[39m         [35m200[39m[33m,[39m
     [90m 127 |[39m         [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:124:42)

  ‚óè Financial Calculator ‚Ä∫ calculateBalanceSummary ‚Ä∫ should handle zero pending amounts

    TypeError: financial_calculator_1.FinancialCalculator.calculateBalanceSummary is not a function

    [0m [90m 138 |[39m
     [90m 139 |[39m     it([32m"should handle zero pending amounts"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 140 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateBalanceSummary([35m1000[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 141 |[39m       expect(result[33m.[39mavailableBalance)[33m.[39mtoBe([35m1000[39m)[33m;[39m
     [90m 142 |[39m     })[33m;[39m
     [90m 143 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:140:42)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should calculate fixed fee only

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 145 |[39m   describe([32m"calculateTransactionFee"[39m[33m,[39m () [33m=>[39m {
     [90m 146 |[39m     it([32m"should calculate fixed fee only"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 147 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m100[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 148 |[39m         fixedFee[33m:[39m [35m2.5[39m[33m,[39m
     [90m 149 |[39m       })[33m;[39m
     [90m 150 |[39m       expect(fee)[33m.[39mtoBe([35m2.5[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:147:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should calculate percentage fee only

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 152 |[39m
     [90m 153 |[39m     it([32m"should calculate percentage fee only"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 154 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m100[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 155 |[39m         percentageFee[33m:[39m [35m0.02[39m[33m,[39m
     [90m 156 |[39m       })[33m;[39m
     [90m 157 |[39m       expect(fee)[33m.[39mtoBe([35m2.0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:154:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should calculate combined fee

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 159 |[39m
     [90m 160 |[39m     it([32m"should calculate combined fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 161 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m100[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 162 |[39m         fixedFee[33m:[39m [35m1.0[39m[33m,[39m
     [90m 163 |[39m         percentageFee[33m:[39m [35m0.02[39m[33m,[39m
     [90m 164 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:161:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should apply minimum fee

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 167 |[39m
     [90m 168 |[39m     it([32m"should apply minimum fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 169 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m10[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 170 |[39m         fixedFee[33m:[39m [35m0.5[39m[33m,[39m
     [90m 171 |[39m         percentageFee[33m:[39m [35m0.01[39m[33m,[39m
     [90m 172 |[39m         minFee[33m:[39m [35m2.0[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:169:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should apply maximum fee

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 176 |[39m
     [90m 177 |[39m     it([32m"should apply maximum fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 178 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m10000[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 179 |[39m         percentageFee[33m:[39m [35m0.05[39m[33m,[39m
     [90m 180 |[39m         maxFee[33m:[39m [35m25.0[39m[33m,[39m
     [90m 181 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:178:39)

  ‚óè Financial Calculator ‚Ä∫ calculateConversionWithSpread ‚Ä∫ should calculate conversion with spread

    TypeError: financial_calculator_1.FinancialCalculator.calculateConversionWithSpread is not a function

    [0m [90m 186 |[39m   describe([32m"calculateConversionWithSpread"[39m[33m,[39m () [33m=>[39m {
     [90m 187 |[39m     it([32m"should calculate conversion with spread"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 188 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateConversionWithSpread(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 189 |[39m         [35m100[39m[33m,[39m
     [90m 190 |[39m         [35m1.2[39m[33m,[39m
     [90m 191 |[39m         [35m0.02[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:188:42)

  ‚óè Financial Calculator ‚Ä∫ calculateMonthlyPayment ‚Ä∫ should calculate loan payment correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateMonthlyPayment is not a function

    [0m [90m 199 |[39m   describe([32m"calculateMonthlyPayment"[39m[33m,[39m () [33m=>[39m {
     [90m 200 |[39m     it([32m"should calculate loan payment correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 201 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateMonthlyPayment(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 202 |[39m         [35m100000[39m[33m,[39m
     [90m 203 |[39m         [35m0.05[39m[33m,[39m
     [90m 204 |[39m         [35m360[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:201:42)

  ‚óè Financial Calculator ‚Ä∫ calculateMonthlyPayment ‚Ä∫ should handle zero interest loan

    TypeError: financial_calculator_1.FinancialCalculator.calculateMonthlyPayment is not a function

    [0m [90m 210 |[39m
     [90m 211 |[39m     it([32m"should handle zero interest loan"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 212 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateMonthlyPayment([35m12000[39m[33m,[39m [35m0[39m[33m,[39m [35m12[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 213 |[39m       expect(result[33m.[39mmonthlyPayment)[33m.[39mtoBe([35m1000.0[39m)[33m;[39m
     [90m 214 |[39m       expect(result[33m.[39mtotalPayment)[33m.[39mtoBe([35m12000.0[39m)[33m;[39m
     [90m 215 |[39m       expect(result[33m.[39mtotalInterest)[33m.[39mtoBe([35m0.0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:212:42)

  ‚óè Financial Calculator ‚Ä∫ calculateMonthlyPayment ‚Ä∫ should reject invalid parameters

    expect(received).toThrow(expected)

    Expected substring: "Invalid loan parameters"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateMonthlyPayment is not a function"

        [0m [90m 218 |[39m     it([32m"should reject invalid parameters"[39m[33m,[39m () [33m=>[39m {
         [90m 219 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 220 |[39m         [33mFinancialCalculator[39m[33m.[39mcalculateMonthlyPayment([33m-[39m[35m1000[39m[33m,[39m [35m0.05[39m[33m,[39m [35m360[39m)[33m,[39m
         [90m     |[39m                             [31m[1m^[22m[39m
         [90m 221 |[39m       )[33m.[39mtoThrow([32m"Invalid loan parameters"[39m)[33m;[39m
         [90m 222 |[39m
         [90m 223 |[39m       expect(() [33m=>[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:220:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:221:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:221:9)

  ‚óè Financial Calculator ‚Ä∫ calculateAmortizationSchedule ‚Ä∫ should generate amortization schedule

    TypeError: financial_calculator_1.FinancialCalculator.calculateAmortizationSchedule is not a function

    [0m [90m 233 |[39m   describe([32m"calculateAmortizationSchedule"[39m[33m,[39m () [33m=>[39m {
     [90m 234 |[39m     it([32m"should generate amortization schedule"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 235 |[39m       [36mconst[39m schedule [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateAmortizationSchedule(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 236 |[39m         [35m1000[39m[33m,[39m
     [90m 237 |[39m         [35m0.12[39m[33m,[39m
     [90m 238 |[39m         [35m12[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:235:44)

  ‚óè Financial Calculator ‚Ä∫ calculateNPV ‚Ä∫ should calculate NPV correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateNPV is not a function

    [0m [90m 258 |[39m     it([32m"should calculate NPV correctly"[39m[33m,[39m () [33m=>[39m {
     [90m 259 |[39m       [36mconst[39m cashFlows [33m=[39m [[33m-[39m[35m1000[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m][33m;[39m
    [31m[1m>[22m[39m[90m 260 |[39m       [36mconst[39m npv [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateNPV(cashFlows[33m,[39m [35m0.1[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 261 |[39m       expect(npv)[33m.[39mtoBeCloseTo([33m-[39m[35m49.04[39m[33m,[39m [35m2[39m)[33m;[39m
     [90m 262 |[39m     })[33m;[39m
     [90m 263 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:260:39)

  ‚óè Financial Calculator ‚Ä∫ calculateIRR ‚Ä∫ should calculate IRR correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateIRR is not a function

    [0m [90m 266 |[39m     it([32m"should calculate IRR correctly"[39m[33m,[39m () [33m=>[39m {
     [90m 267 |[39m       [36mconst[39m cashFlows [33m=[39m [[33m-[39m[35m1000[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m][33m;[39m
    [31m[1m>[22m[39m[90m 268 |[39m       [36mconst[39m irr [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateIRR(cashFlows[33m,[39m [35m0.1[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 269 |[39m       expect(irr)[33m.[39mtoBeCloseTo([35m0.0771[39m[33m,[39m [35m4[39m)[33m;[39m
     [90m 270 |[39m     })[33m;[39m
     [90m 271 |[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:268:39)

  ‚óè Financial Calculator ‚Ä∫ calculateIRR ‚Ä∫ should throw if IRR calculation fails to converge

    expect(received).toThrow(expected)

    Expected substring: "IRR calculation failed to converge"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateIRR is not a function"

        [0m [90m 272 |[39m     it([32m"should throw if IRR calculation fails to converge"[39m[33m,[39m () [33m=>[39m {
         [90m 273 |[39m       [36mconst[39m cashFlows [33m=[39m [[35m0[39m][33m;[39m [90m// Single zero - won't converge[39m
        [31m[1m>[22m[39m[90m 274 |[39m       expect(() [33m=>[39m [33mFinancialCalculator[39m[33m.[39mcalculateIRR(cashFlows))[33m.[39mtoThrow(
         [90m     |[39m                                        [31m[1m^[22m[39m
         [90m 275 |[39m         [32m"IRR calculation failed to converge"[39m[33m,[39m
         [90m 276 |[39m       )[33m;[39m
         [90m 277 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:274:40
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:274:65)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:274:65)

  ‚óè FinancialCalculations ‚Ä∫ convertCurrency ‚Ä∫ should be an alias to FinancialCalculator.convertCurrency

    TypeError: Cannot read properties of undefined (reading 'convertCurrency')

    [0m [90m 282 |[39m   describe([32m"convertCurrency"[39m[33m,[39m () [33m=>[39m {
     [90m 283 |[39m     it([32m"should be an alias to FinancialCalculator.convertCurrency"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 284 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mconvertCurrency(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 285 |[39m         [35m100[39m[33m,[39m
     [90m 286 |[39m         [32m"USD"[39m[33m,[39m
     [90m 287 |[39m         [32m"EUR"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:284:44)

  ‚óè FinancialCalculations ‚Ä∫ calculateTotalWithFees ‚Ä∫ should calculate total with fees

    TypeError: Cannot read properties of undefined (reading 'calculateTotalWithFees')

    [0m [90m 294 |[39m   describe([32m"calculateTotalWithFees"[39m[33m,[39m () [33m=>[39m {
     [90m 295 |[39m     it([32m"should calculate total with fees"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 296 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mcalculateTotalWithFees([35m100[39m[33m,[39m {
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 297 |[39m         fixedFee[33m:[39m [35m2.5[39m[33m,[39m
     [90m 298 |[39m         percentageFee[33m:[39m [35m0.01[39m[33m,[39m
     [90m 299 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:296:44)

  ‚óè FinancialCalculations ‚Ä∫ calculateTotalWithFees ‚Ä∫ should handle no fees

    TypeError: Cannot read properties of undefined (reading 'calculateTotalWithFees')

    [0m [90m 307 |[39m
     [90m 308 |[39m     it([32m"should handle no fees"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 309 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mcalculateTotalWithFees([35m100[39m[33m,[39m {})[33m;[39m
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 310 |[39m
     [90m 311 |[39m       expect(result)[33m.[39mtoEqual({
     [90m 312 |[39m         subtotal[33m:[39m [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:309:44)

  ‚óè FinancialCalculations ‚Ä∫ calculateLoanDetails ‚Ä∫ should provide complete loan details

    TypeError: Cannot read properties of undefined (reading 'calculateLoanDetails')

    [0m [90m 319 |[39m   describe([32m"calculateLoanDetails"[39m[33m,[39m () [33m=>[39m {
     [90m 320 |[39m     it([32m"should provide complete loan details"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 321 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mcalculateLoanDetails(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 322 |[39m         [35m100000[39m[33m,[39m
     [90m 323 |[39m         [35m0.05[39m[33m,[39m
     [90m 324 |[39m         [35m360[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:321:44)

  console.log
    Starting test: should register a new user successfully

      at Object.<anonymous> (src/__tests__/auth.test.ts:68:15)

  console.log
    Test data: {
      email: 'test@example.com',
      password: 'password123',
      name: 'Test User'
    }

      at Object.<anonymous> (src/__tests__/auth.test.ts:76:15)

  console.log
    Calling authService.register...

      at Object.<anonymous> (src/__tests__/auth.test.ts:93:15)

  console.error
    Error in authService.register: TypeError: bcryptjs_1.default.genSalt is not a function
        at AuthService.register (C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\services\auth.service.ts:122:31)
        at Object.<anonymous> (C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\auth.test.ts:96:18)

    [0m [90m  97 |[39m         console[33m.[39mlog([32m"authService.register result:"[39m[33m,[39m result)[33m;[39m
     [90m  98 |[39m       } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m  99 |[39m         console[33m.[39merror([32m"Error in authService.register:"[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 100 |[39m         [36mthrow[39m error[33m;[39m
     [90m 101 |[39m       }
     [90m 102 |[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:99:17)

FAIL src/__tests__/auth.test.ts
  AuthService
    register
      √ó should register a new user successfully (34 ms)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should register a new user successfully

    TypeError: bcryptjs_1.default.genSalt is not a function

    [0m [90m 120 |[39m
     [90m 121 |[39m     [90m// Hash password with salt[39m
    [31m[1m>[22m[39m[90m 122 |[39m     [36mconst[39m salt [33m=[39m [36mawait[39m bcrypt[33m.[39mgenSalt([35m10[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 123 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash(userData[33m.[39mpassword[33m,[39m salt)[33m;[39m
     [90m 124 |[39m
     [90m 125 |[39m     [90m// Create user[39m[0m

      at AuthService.register (src/services/auth.service.ts:122:31)
      at Object.<anonymous> (src/__tests__/auth.test.ts:96:18)

FAIL src/__tests__/auth.service.test.ts
  AuthService
    register
      √ó should register a new user successfully (2 ms)
      √ó should throw an error if user already exists (9 ms)
    login
      √ó should login a user with valid credentials (2 ms)
      √ó should throw an error for invalid credentials (7 ms)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should register a new user successfully

    TypeError: bcryptjs_1.default.genSalt is not a function

    [0m [90m 120 |[39m
     [90m 121 |[39m     [90m// Hash password with salt[39m
    [31m[1m>[22m[39m[90m 122 |[39m     [36mconst[39m salt [33m=[39m [36mawait[39m bcrypt[33m.[39mgenSalt([35m10[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 123 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash(userData[33m.[39mpassword[33m,[39m salt)[33m;[39m
     [90m 124 |[39m
     [90m 125 |[39m     [90m// Create user[39m[0m

      at AuthService.register (src/services/auth.service.ts:122:31)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:103:22)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should throw an error if user already exists

    expect(received).rejects.toThrow(expected)

    Expected substring: "User already exists"
    Received message:   "Email is already registered"

        [0m [90m 113 |[39m
         [90m 114 |[39m     [36mif[39m (existingUser) {
        [31m[1m>[22m[39m[90m 115 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m(
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 116 |[39m         [33mStatusCodes[39m[33m.[39m[33mBAD_REQUEST[39m[33m,[39m
         [90m 117 |[39m         [32m"Email is already registered"[39m[33m,[39m
         [90m 118 |[39m       )[33m;[39m[0m

      at AuthService.register (src/services/auth.service.ts:115:13)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:139:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:139:60)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should login a user with valid credentials

    TypeError: Cannot read properties of undefined (reading 'create')

    [0m [90m 86 |[39m   expiresAt[33m.[39msetSeconds(expiresAt[33m.[39mgetSeconds() [33m+[39m [33mREFRESH_TOKEN_EXPIRES_IN[39m)[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m   [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mcreate({
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 89 |[39m     data[33m:[39m {
     [90m 90 |[39m       tokenHash[33m:[39m token[33m,[39m [90m// Store the token as hash[39m
     [90m 91 |[39m       userId[33m,[39m[0m

      at generateRefreshToken (src/services/auth.service.ts:88:29)
      at AuthService.generateAuthTokens (src/services/auth.service.ts:211:7)
      at AuthService.login (src/services/auth.service.ts:174:31)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:180:22)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should throw an error for invalid credentials

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid credentials"
    Received message:   "Invalid email or password"

        [0m [90m 168 |[39m     )[33m;[39m
         [90m 169 |[39m     [36mif[39m ([33m![39misPasswordValid) {
        [31m[1m>[22m[39m[90m 170 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([33mStatusCodes[39m[33m.[39m[33mUNAUTHORIZED[39m[33m,[39m [32m"Invalid email or password"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 171 |[39m     }
         [90m 172 |[39m
         [90m 173 |[39m     [90m// Generate tokens[39m[0m

      at AuthService.login (src/services/auth.service.ts:170:13)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:221:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:221:60)

  console.log
    [CIRCUIT_BREAKER] test-service: Success recorded. State: CLOSED

      at CircuitBreaker.onSuccess (src/utils/circuitBreaker.ts:111:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 100.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 100.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 100.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Opening to HALF_OPEN state

      at CircuitBreaker.execute (src/utils/circuitBreaker.ts:53:15)

  console.log
    [CIRCUIT_BREAKER] test-service: Success recorded. State: HALF_OPEN

      at CircuitBreaker.onSuccess (src/utils/circuitBreaker.ts:111:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 100.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Opening to HALF_OPEN state

      at CircuitBreaker.execute (src/utils/circuitBreaker.ts:53:15)

  console.log
    [CIRCUIT_BREAKER] test-service: Success recorded. State: HALF_OPEN

      at CircuitBreaker.onSuccess (src/utils/circuitBreaker.ts:111:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit CLOSED after successful half-open period

      at CircuitBreaker.onSuccess (src/utils/circuitBreaker.ts:105:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Success recorded. State: CLOSED

      at CircuitBreaker.onSuccess (src/utils/circuitBreaker.ts:111:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 100.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Opening to HALF_OPEN state

      at CircuitBreaker.execute (src/utils/circuitBreaker.ts:53:15)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN after failure in half-open state

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:127:15)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 2

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Success recorded. State: CLOSED

      at CircuitBreaker.onSuccess (src/utils/circuitBreaker.ts:111:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 50.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit OPEN. Failures: 1, Error Rate: 100.00%

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:140:17)

  console.log
    [CIRCUIT_BREAKER] test-service: Failure recorded. State: OPEN, Total Failures: 1

      at CircuitBreaker.onFailure (src/utils/circuitBreaker.ts:146:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] test-service: Circuit manually OPENED

      at CircuitBreaker.open (src/utils/circuitBreaker.ts:216:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually OPENED

      at CircuitBreaker.open (src/utils/circuitBreaker.ts:216:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually OPENED

      at CircuitBreaker.open (src/utils/circuitBreaker.ts:216:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually OPENED

      at CircuitBreaker.open (src/utils/circuitBreaker.ts:216:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually OPENED

      at CircuitBreaker.open (src/utils/circuitBreaker.ts:216:13)

  console.log
    [CIRCUIT_BREAKER] service1: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

  console.log
    [CIRCUIT_BREAKER] service2: Circuit manually reset to CLOSED

      at CircuitBreaker.reset (src/utils/circuitBreaker.ts:205:13)

PASS src/__tests__/utils/circuitBreaker.test.ts
  Circuit Breaker
    CircuitBreaker Class
      ‚àö should start in CLOSED state (2 ms)
      ‚àö should execute successful calls (10 ms)
      ‚àö should open circuit after failure threshold (2 ms)
      ‚àö should reject calls when circuit is OPEN (14 ms)
      ‚àö should transition to HALF_OPEN after reset timeout (1106 ms)
      ‚àö should close circuit after successful calls in HALF_OPEN (1115 ms)
      ‚àö should open circuit again on failure in HALF_OPEN (1113 ms)
      ‚àö should provide correct statistics (4 ms)
      ‚àö should reset manually (4 ms)
      ‚àö should open manually (2 ms)
    CircuitBreakerRegistry
      ‚àö should create and retrieve circuit breakers (1 ms)
      ‚àö should get all circuit breakers (6 ms)
      ‚àö should get all stats (3 ms)
      ‚àö should check for open circuits (7 ms)
      ‚àö should reset all circuit breakers (5 ms)
    withCircuitBreaker decorator
      ‚óã skipped should wrap methods with circuit breaker
      ‚óã skipped should execute wrapped methods through circuit breaker

PASS src/__tests__/transactions.test.ts
  Transactions Module
    TransactionsService
      list
        ‚àö should list transactions for a company (2 ms)
      create
        ‚àö should create a balanced transaction (5 ms)
        ‚àö should throw error for unbalanced transaction (60 ms)
    TransactionsController
      list
        ‚àö should return transactions list (2 ms)
        ‚àö should use default limit when not provided (2 ms)
        ‚àö should handle validation errors (2 ms)
      create
        ‚àö should create and return transaction (2 ms)
        ‚àö should handle balance validation errors (2 ms)

PASS src/__tests__/accounts.test.ts
  Accounts Module
    AccountsService
      list
        ‚àö should list accounts for a company (2 ms)
      create
        ‚àö should create a new account (2 ms)
      update
        ‚àö should update an account (2 ms)
      adjustBalance
        ‚àö should adjust account balance (1 ms)
        ‚àö should throw error for NaN amount (54 ms)
    AccountsController
      list
        ‚àö should return accounts list (3 ms)
        ‚àö should handle validation errors (2 ms)
      create
        ‚àö should create and return account (2 ms)
      update
        ‚àö should update and return account (2 ms)
      adjustBalance
        ‚àö should adjust account balance (1 ms)

  console.error
    [ERROR] NOT_FOUND: Test error {
      statusCode: 404,
      requestId: undefined,
      url: '/test',
      method: 'GET',
      ip: '127.0.0.1',
      userAgent: undefined,
      stack: 'Error: Test error\n' +
        '    at Object.<anonymous> (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\src\\__tests__\\utils\\errorHandler.test.ts:108:21)\n' +
        '    at Promise.then.completed (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
        '    at _callCircusTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
        '    at _runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at run (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
        '    at runTestInternal (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
        '    at runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:444:34)'
    }

    [0m [90m 188 |[39m
     [90m 189 |[39m   [90m// Log error for debugging[39m
    [31m[1m>[22m[39m[90m 190 |[39m   console[33m.[39merror([32m`[ERROR] ${errorCode}: ${error.message}`[39m[33m,[39m {
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 191 |[39m     statusCode[33m,[39m
     [90m 192 |[39m     requestId[33m:[39m req[33m.[39mheaders[[32m"x-request-id"[39m][33m,[39m
     [90m 193 |[39m     url[33m:[39m req[33m.[39murl[33m,[39m[0m

      at globalErrorHandler (src/utils/errorHandler.ts:190:11)
      at Object.<anonymous> (src/__tests__/utils/errorHandler.test.ts:110:25)

  console.error
    [ERROR] DUPLICATE_RESOURCE: Unique constraint failed {
      statusCode: 409,
      requestId: undefined,
      url: '/test',
      method: 'GET',
      ip: '127.0.0.1',
      userAgent: undefined,
      stack: 'PrismaClientKnownRequestError: Unique constraint failed\n' +
        '    at Object.<anonymous> (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\src\\__tests__\\utils\\errorHandler.test.ts:130:21)\n' +
        '    at Promise.then.completed (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
        '    at _callCircusTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
        '    at _runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at run (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
        '    at runTestInternal (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
        '    at runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:444:34)'
    }

    [0m [90m 188 |[39m
     [90m 189 |[39m   [90m// Log error for debugging[39m
    [31m[1m>[22m[39m[90m 190 |[39m   console[33m.[39merror([32m`[ERROR] ${errorCode}: ${error.message}`[39m[33m,[39m {
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 191 |[39m     statusCode[33m,[39m
     [90m 192 |[39m     requestId[33m:[39m req[33m.[39mheaders[[32m"x-request-id"[39m][33m,[39m
     [90m 193 |[39m     url[33m:[39m req[33m.[39murl[33m,[39m[0m

      at globalErrorHandler (src/utils/errorHandler.ts:190:11)
      at Object.<anonymous> (src/__tests__/utils/errorHandler.test.ts:135:25)

  console.error
    [ERROR] RESOURCE_NOT_FOUND: Record not found {
      statusCode: 404,
      requestId: undefined,
      url: '/test',
      method: 'GET',
      ip: '127.0.0.1',
      userAgent: undefined,
      stack: 'PrismaClientKnownRequestError: Record not found\n' +
        '    at Object.<anonymous> (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\src\\__tests__\\utils\\errorHandler.test.ts:153:21)\n' +
        '    at Promise.then.completed (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
        '    at _callCircusTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
        '    at _runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at run (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
        '    at runTestInternal (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
        '    at runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:444:34)'
    }

    [0m [90m 188 |[39m
     [90m 189 |[39m   [90m// Log error for debugging[39m
    [31m[1m>[22m[39m[90m 190 |[39m   console[33m.[39merror([32m`[ERROR] ${errorCode}: ${error.message}`[39m[33m,[39m {
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 191 |[39m     statusCode[33m,[39m
     [90m 192 |[39m     requestId[33m:[39m req[33m.[39mheaders[[32m"x-request-id"[39m][33m,[39m
     [90m 193 |[39m     url[33m:[39m req[33m.[39murl[33m,[39m[0m

      at globalErrorHandler (src/utils/errorHandler.ts:190:11)
      at Object.<anonymous> (src/__tests__/utils/errorHandler.test.ts:158:25)

  console.error
    [ERROR] TOKEN_INVALID: Invalid token {
      statusCode: 401,
      requestId: undefined,
      url: '/test',
      method: 'GET',
      ip: '127.0.0.1',
      userAgent: undefined,
      stack: 'JsonWebTokenError: Invalid token\n' +
        '    at Object.<anonymous> (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\src\\__tests__\\utils\\errorHandler.test.ts:176:24)\n' +
        '    at Promise.then.completed (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
        '    at _callCircusTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
        '    at _runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at run (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
        '    at runTestInternal (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
        '    at runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:444:34)'
    }

    [0m [90m 188 |[39m
     [90m 189 |[39m   [90m// Log error for debugging[39m
    [31m[1m>[22m[39m[90m 190 |[39m   console[33m.[39merror([32m`[ERROR] ${errorCode}: ${error.message}`[39m[33m,[39m {
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 191 |[39m     statusCode[33m,[39m
     [90m 192 |[39m     requestId[33m:[39m req[33m.[39mheaders[[32m"x-request-id"[39m][33m,[39m
     [90m 193 |[39m     url[33m:[39m req[33m.[39murl[33m,[39m[0m

      at globalErrorHandler (src/utils/errorHandler.ts:190:11)
      at Object.<anonymous> (src/__tests__/utils/errorHandler.test.ts:179:25)

  console.error
    [ERROR] INTERNAL_ERROR: Something went wrong {
      statusCode: 500,
      requestId: undefined,
      url: '/test',
      method: 'GET',
      ip: '127.0.0.1',
      userAgent: undefined,
      stack: 'Error: Something went wrong\n' +
        '    at Object.<anonymous> (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\src\\__tests__\\utils\\errorHandler.test.ts:197:21)\n' +
        '    at Promise.then.completed (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\utils.js:231:10)\n' +
        '    at _callCircusTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:316:40)\n' +
        '    at _runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:121:9)\n' +
        '    at run (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n' +
        '    at runTestInternal (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n' +
        '    at runTest (C:\\FidiMyProjects2025\\Software_Projects\\AccuBooks\\AccuBooks\\backend\\node_modules\\jest-runner\\build\\runTest.js:444:34)'
    }

    [0m [90m 188 |[39m
     [90m 189 |[39m   [90m// Log error for debugging[39m
    [31m[1m>[22m[39m[90m 190 |[39m   console[33m.[39merror([32m`[ERROR] ${errorCode}: ${error.message}`[39m[33m,[39m {
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 191 |[39m     statusCode[33m,[39m
     [90m 192 |[39m     requestId[33m:[39m req[33m.[39mheaders[[32m"x-request-id"[39m][33m,[39m
     [90m 193 |[39m     url[33m:[39m req[33m.[39murl[33m,[39m[0m

      at globalErrorHandler (src/utils/errorHandler.ts:190:11)
      at Object.<anonymous> (src/__tests__/utils/errorHandler.test.ts:199:25)

PASS src/__tests__/utils/errorHandler.test.ts
  Error Handler Utils
    ApiError
      ‚àö should create ApiError with default values (2 ms)
      ‚àö should create ApiError with custom values (1 ms)
    createErrorResponse
      ‚àö should create basic error response (1 ms)
      ‚àö should include details when provided (1 ms)
      ‚àö should include requestId when provided (1 ms)
    globalErrorHandler
      ‚àö should handle ApiError correctly (27 ms)
      ‚àö should handle Prisma known request errors (8 ms)
      ‚àö should handle Prisma record not found errors (11 ms)
      ‚àö should handle JWT errors (8 ms)
      ‚àö should handle generic errors (9 ms)
    notFoundHandler
      ‚àö should create 404 error for undefined routes (2 ms)
    asyncHandler
      ‚àö should handle resolved promises (1 ms)
      ‚àö should handle rejected promises (1 ms)
    SystemPanicMonitor
      ‚àö should record requests correctly (3 ms)
      ‚àö should detect high memory usage (2 ms)
      ‚àö should detect high error rate (1 ms)
      ‚àö should detect high response time (1 ms)
      ‚àö should reset metrics (2 ms)

PASS src/__tests__/integration/simple.test.ts
  Simple Test
    ‚àö should pass (2 ms)

PASS src/__tests__/example.test.ts
  Example Test
    ‚àö should pass (1 ms)

FAIL src/__tests__/integration/mail/test.module.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/utils/performance.test.ts
  ‚óè Test suite failed to run

    Cannot find module './logger.js' from 'src/utils/cacheEngine.ts'

    Require stack:
      src/utils/cacheEngine.ts
      src/__tests__/utils/performance.test.ts

    [0m [90m 1 |[39m [36mimport[39m [33mRedis[39m [36mfrom[39m [32m"ioredis"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { logger } [36mfrom[39m [32m"./logger.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m
     [90m 4 |[39m [90m/**[39m
     [90m 5 |[39m [90m * Redis caching engine with intelligent invalidation[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/utils/cacheEngine.ts:2:1)
      at Object.<anonymous> (src/__tests__/utils/performance.test.ts:9:1)

FAIL src/__tests__/security/databaseSecurity.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../constants/roles.js' from 'src/services/databaseSecurity.service.ts'

    Require stack:
      src/services/databaseSecurity.service.ts
      src/__tests__/security/databaseSecurity.test.ts

    [0m [90m 2 |[39m [90m// @ts-ignore[39m
     [90m 3 |[39m [36mimport[39m { [33mPrismaClient[39m } [36mfrom[39m [32m"@prisma/client"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mimport[39m { [33mROLES[39m[33m,[39m [33mROLES_HIERARCHY[39m } [36mfrom[39m [32m"../constants/roles.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m [36mconst[39m prisma [33m=[39m [33mPrismaClientSingleton[39m[33m.[39mgetInstance()[33m;[39m
     [90m 7 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/services/databaseSecurity.service.ts:4:1)
      at Object.<anonymous> (src/__tests__/security/databaseSecurity.test.ts:3:1)

FAIL src/__tests__/security/security.middleware.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../middleware/security' from 'src/__tests__/security/security.middleware.test.ts'

    [0m [90m 1 |[39m [36mimport[39m request [36mfrom[39m [32m"supertest"[39m[33m;[39m
     [90m 2 |[39m [36mimport[39m express [36mfrom[39m [32m"express"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 3 |[39m [36mimport[39m applySecurityMiddlewares[33m,[39m {
     [90m   |[39m [31m[1m^[22m[39m
     [90m 4 |[39m   authRateLimiter[33m,[39m
     [90m 5 |[39m   sensitiveRouteLimiter[33m,[39m
     [90m 6 |[39m } [36mfrom[39m [32m"../../middleware/security"[39m[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/security/security.middleware.test.ts:3:1)

FAIL src/__tests__/security/auditLogger.integration.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../middleware/security/auditLogger.middleware.js' from 'src/__tests__/security/auditLogger.integration.test.ts'

    [0m [90m 47 |[39m   logAllRequests[33m,[39m
     [90m 48 |[39m   logPerformance[33m,[39m
    [31m[1m>[22m[39m[90m 49 |[39m } [33m=[39m require([32m"../../middleware/security/auditLogger.middleware.js"[39m)[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 50 |[39m
     [90m 51 |[39m describe([32m"Audit Logger Integration Tests"[39m[33m,[39m () [33m=>[39m {
     [90m 52 |[39m   [36mlet[39m app[33m:[39m express[33m.[39m[33mApplication[39m[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/security/auditLogger.integration.test.ts:49:5)

FAIL src/__tests__/security/auditLogger.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../middleware/security/auditLogger.middleware.js' from 'src/__tests__/security/auditLogger.test.ts'

    [0m [90m 3 |[39m [36mimport[39m [33mAuditLoggerService[39m [36mfrom[39m [32m"../../services/auditLogger.service"[39m[33m;[39m
     [90m 4 |[39m [36mimport[39m [33mMonitoringService[39m [36mfrom[39m [32m"../../services/monitoring.service"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 5 |[39m [36mimport[39m {
     [90m   |[39m [31m[1m^[22m[39m
     [90m 6 |[39m   logAuthEvent[33m,[39m
     [90m 7 |[39m   logDataEvent[33m,[39m
     [90m 8 |[39m   logSecurityEvent[33m,[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/security/auditLogger.test.ts:5:1)

FAIL src/__tests__/integration/invoice.service.integration.test.ts
  ‚óè Test suite failed to run

    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m82[0m:[93m7[0m - [91merror[0m[90m TS1109: [0mExpression expected.

    [7m82[0m       };
    [7m  [0m [91m      ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m83[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m83[0m     }),
    [7m  [0m [91m    ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m83[0m:[93m6[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m83[0m     }),
    [7m  [0m [91m     ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m83[0m:[93m7[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m83[0m     }),
    [7m  [0m [91m      ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m84[0m:[93m3[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m84[0m   };
    [7m  [0m [91m  ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m85[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m85[0m });
    [7m  [0m [91m~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m85[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m85[0m });
    [7m  [0m [91m ~[0m

FAIL src/__tests__/business-logic/domain.validator.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../utils/errorHandler.js' from 'src/business-logic/validators/domain.validator.ts'

    Require stack:
      src/business-logic/validators/domain.validator.ts
      src/__tests__/business-logic/domain.validator.test.ts

    [0m[31m[1m>[22m[39m[90m 1 |[39m [36mimport[39m { [33mApiError[39m[33m,[39m [33mErrorCodes[39m } [36mfrom[39m [32m"../../utils/errorHandler.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 2 |[39m
     [90m 3 |[39m [90m/**[39m
     [90m 4 |[39m [90m * Domain validation framework for financial operations[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/business-logic/validators/domain.validator.ts:1:1)
      at Object.<anonymous> (src/__tests__/business-logic/domain.validator.test.ts:1:1)

FAIL src/__tests__/business-logic/fraud.detector.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../utils/logger.js' from 'src/business-logic/anti-fraud/fraud.detector.ts'

    Require stack:
      src/business-logic/anti-fraud/fraud.detector.ts
      src/__tests__/business-logic/fraud.detector.test.ts

    [0m [90m 1 |[39m [36mimport[39m { [33mApiError[39m[33m,[39m [33mErrorCodes[39m } [36mfrom[39m [32m"../../utils/errorHandler.js"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { logger } [36mfrom[39m [32m"../../utils/logger.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m
     [90m 4 |[39m [90m/**[39m
     [90m 5 |[39m [90m * Anti-fraud detection system[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/business-logic/anti-fraud/fraud.detector.ts:2:1)
      at Object.<anonymous> (src/__tests__/business-logic/fraud.detector.test.ts:1:1)

FAIL src/__tests__/setupTests.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/setup.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/errorHandler.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../utils/errors.js' from 'src/middleware/errorHandler.ts'

    Require stack:
      src/middleware/errorHandler.ts
      src/__tests__/errorHandler.test.ts

    [0m [90m 1 |[39m [36mimport[39m { [33mRequest[39m[33m,[39m [33mResponse[39m[33m,[39m [33mNextFunction[39m } [36mfrom[39m [32m'express'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { [33mApiError[39m } [36mfrom[39m [32m'../utils/errors.js'[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m [36mimport[39m { logger } [36mfrom[39m [32m'../utils/logger.js'[39m[33m;[39m
     [90m 4 |[39m
     [90m 5 |[39m [36mexport[39m [36mconst[39m errorHandler [33m=[39m ([0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/middleware/errorHandler.ts:2:1)
      at Object.<anonymous> (src/__tests__/errorHandler.test.ts:13:1)

Summary of all failing tests
FAIL src/__tests__/integration/mail/mail.service.integration.test.ts (5.202 s)
  ‚óè MailService Integration Tests ‚Ä∫ sendMail ‚Ä∫ should send an email with template successfully

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 29 |[39m   [36masync[39m sendMail(to[33m:[39m string[33m,[39m subject[33m:[39m string[33m,[39m template[33m:[39m string[33m,[39m context[33m:[39m any) {
     [90m 30 |[39m     [36mconst[39m html [33m=[39m [36mthis[39m[33m.[39mcompileTemplate(template[33m,[39m context)[33m;[39m
    [31m[1m>[22m[39m[90m 31 |[39m     [36mawait[39m [36mthis[39m[33m.[39mtransporter[33m.[39msendMail({
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 32 |[39m       [36mfrom[39m[33m:[39m process[33m.[39menv[33m.[39m[33mSMTP_FROM[39m [33m||[39m [32m"no-reply@example.com"[39m[33m,[39m
     [90m 33 |[39m       to[33m,[39m
     [90m 34 |[39m       subject[33m,[39m[0m

      at new MimeNode (node_modules/nodemailer/lib/mime-node/index.js:45:74)
      at MailComposer._createContentNode (node_modules/nodemailer/lib/mail-composer/index.js:503:20)
      at MailComposer.compile (node_modules/nodemailer/lib/mail-composer/index.js:43:33)
      at node_modules/nodemailer/lib/mailer/index.js:187:56
      at processPlugins (node_modules/nodemailer/lib/mailer/index.js:291:28)
      at node_modules/nodemailer/lib/mailer/index.js:299:17
      at Mail._convertDataImages (node_modules/nodemailer/lib/mailer/index.js:403:20)
      at Mail._defaultPlugins.compile (node_modules/nodemailer/lib/mailer/index.js:31:41)
      at processPlugins (node_modules/nodemailer/lib/mailer/index.js:295:13)
      at Mail._processPlugins (node_modules/nodemailer/lib/mailer/index.js:303:9)
      at Mail.sendMail (node_modules/nodemailer/lib/mailer/index.js:173:14)
      at MailService.sendMail (src/mail/mail.service.ts:31:28)
      at Object.<anonymous> (src/__tests__/integration/mail/mail.service.integration.test.ts:126:25)

FAIL src/__tests__/refreshToken.service.test.ts
  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate a token of correct length

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate a token of correct length

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate different tokens each time

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ generateRefreshToken ‚Ä∫ should generate different tokens each time

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should hash a token consistently

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should hash a token consistently

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should produce different hashes for different tokens

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ hashToken ‚Ä∫ should produce different hashes for different tokens

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should create a refresh token for user

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should create a refresh token for user

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should invalidate existing tokens when creating new one

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should invalidate existing tokens when creating new one

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should set correct expiry date

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ createRefreshToken ‚Ä∫ should set correct expiry date

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should verify a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should verify a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject expired token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ verifyRefreshToken ‚Ä∫ should reject expired token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should rotate a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should rotate a valid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should reject rotation of invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ rotateRefreshToken ‚Ä∫ should reject rotation of invalid token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ invalidateUserRefreshTokens ‚Ä∫ should invalidate all user tokens

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ invalidateUserRefreshTokens ‚Ä∫ should invalidate all user tokens

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should invalidate specific token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should invalidate specific token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should throw error for non-existent token

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ invalidateRefreshToken ‚Ä∫ should throw error for non-existent token

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should clean up expired tokens

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should clean up expired tokens

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should return 0 when no expired tokens exist

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ cleanupExpiredTokens ‚Ä∫ should return 0 when no expired tokens exist

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ getAccessTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ getAccessTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

  ‚óè RefreshTokenService ‚Ä∫ getRefreshTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.user.create()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:13:34

      10 
      11 beforeEach(async () => {
      12   // Create a test user
    ‚Üí 13   testUser = await prisma.user.create(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 11 |[39m   beforeEach([36masync[39m () [33m=>[39m {
     [90m 12 |[39m     [90m// Create a test user[39m
    [31m[1m>[22m[39m[90m 13 |[39m     testUser [33m=[39m [36mawait[39m prisma[33m.[39muser[33m.[39mcreate({
     [90m    |[39m                [31m[1m^[22m[39m
     [90m 14 |[39m       data[33m:[39m {
     [90m 15 |[39m         name[33m:[39m [32m"Test User"[39m[33m,[39m
     [90m 16 |[39m         email[33m:[39m [32m`test-${Date.now()}@example.com`[39m[33m,[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:13:16)

  ‚óè RefreshTokenService ‚Ä∫ getRefreshTokenExpiry ‚Ä∫ should return correct expiry time

    PrismaClientInitializationError: 
    Invalid `prisma.refreshToken.deleteMany()` invocation in
    C:\FidiMyProjects2025\Software_Projects\AccuBooks\AccuBooks\backend\src\__tests__\refreshToken.service.test.ts:29:31

      26 
      27 afterEach(async () => {
      28   // Clean up refresh tokens
    ‚Üí 29   await prisma.refreshToken.deleteMany(
    error: Error validating datasource `db`: the URL must start with the protocol `postgresql://` or `postgres://`.
      -->  schema.prisma:8
       | 
     7 |   provider = "postgresql"
     8 |   url      = env("DATABASE_URL")
       | 

    Validation Error Count: 1

    [0m [90m 27 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 28 |[39m     [90m// Clean up refresh tokens[39m
    [31m[1m>[22m[39m[90m 29 |[39m     [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mdeleteMany({ where[33m:[39m { userId[33m:[39m testUserId } })[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 30 |[39m
     [90m 31 |[39m     [90m// Clean up test user[39m
     [90m 32 |[39m     [36mawait[39m prisma[33m.[39muser[33m.[39m[36mdelete[39m({ where[33m:[39m { id[33m:[39m testUserId } })[33m;[39m[0m

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7615)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (src/__tests__/refreshToken.service.test.ts:29:5)

FAIL src/__tests__/auth.controller.simple.test.ts
  ‚óè Auth Controller - Simple Tests ‚Ä∫ login ‚Ä∫ should login user successfully

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:106:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ login ‚Ä∫ should handle authentication errors

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:177:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ register ‚Ä∫ should register new user successfully

    TypeError: req.get is not a function

    [0m [90m 224 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 225 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 226 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 227 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 228 |[39m       details[33m:[39m {
     [90m 229 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Registration failed"[39m[33m,[39m[0m

      at register (src/controllers/auth.controller.ts:226:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:212:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ refreshToken ‚Ä∫ should refresh access token successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 200

    Number of calls: 0

    [0m [90m 267 |[39m         mockRefreshToken[33m,[39m
     [90m 268 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 269 |[39m       expect(mockResponse[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([33mStatusCodes[39m[33m.[39m[33mOK[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 270 |[39m       expect(mockResponse[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m 271 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 272 |[39m         data[33m:[39m {[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:269:35)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ logout ‚Ä∫ should logout user successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-refresh-token"

    Number of calls: 0

    [0m [90m 318 |[39m       expect(
     [90m 319 |[39m         mockRefreshTokenService[33m.[39minvalidateRefreshToken[33m,[39m
    [31m[1m>[22m[39m[90m 320 |[39m       )[33m.[39mtoHaveBeenCalledWith(mockRefreshToken)[33m;[39m
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 321 |[39m       expect(mockResponse[33m.[39mclearCookie)[33m.[39mtoHaveBeenCalledWith(
     [90m 322 |[39m         [32m"refreshToken"[39m[33m,[39m
     [90m 323 |[39m         expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:320:9)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ logoutAll ‚Ä∫ should logout from all sessions

    TypeError: logoutAll is not a function

    [0m [90m 348 |[39m       )[33m;[39m
     [90m 349 |[39m
    [31m[1m>[22m[39m[90m 350 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 351 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 352 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 353 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:350:13)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ logoutAll ‚Ä∫ should require authentication

    TypeError: logoutAll is not a function

    [0m [90m 369 |[39m       mockRequest[33m.[39muser [33m=[39m undefined[33m;[39m
     [90m 370 |[39m
    [31m[1m>[22m[39m[90m 371 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 372 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 373 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 374 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:371:13)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ changePassword ‚Ä∫ should change password successfully

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:403:7)

  ‚óè Auth Controller - Simple Tests ‚Ä∫ changePassword ‚Ä∫ should require authentication

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.simple.test.ts:432:13)

FAIL src/__tests__/refreshToken.service.unit.test.ts
  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ generateRefreshToken ‚Ä∫ should generate a token of correct length

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:51:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ generateRefreshToken ‚Ä∫ should generate different tokens each time

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:56:42)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ generateRefreshToken ‚Ä∫ should generate tokens with only hex characters

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:62:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ hashToken ‚Ä∫ should hash a token consistently

    TypeError: Cannot read properties of undefined (reading 'update')

    [0m [90m 21 |[39m [90m   */[39m
     [90m 22 |[39m   [36mstatic[39m hashToken(token[33m:[39m string)[33m:[39m string {
    [31m[1m>[22m[39m[90m 23 |[39m     [36mreturn[39m crypto[33m.[39mcreateHash([32m"sha256"[39m)[33m.[39mupdate(token)[33m.[39mdigest([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 24 |[39m   }
     [90m 25 |[39m
     [90m 26 |[39m   [90m/**[39m[0m

      at Function.hashToken (src/services/refreshToken.service.ts:23:39)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:70:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ hashToken ‚Ä∫ should produce different hashes for different tokens

    TypeError: Cannot read properties of undefined (reading 'update')

    [0m [90m 21 |[39m [90m   */[39m
     [90m 22 |[39m   [36mstatic[39m hashToken(token[33m:[39m string)[33m:[39m string {
    [31m[1m>[22m[39m[90m 23 |[39m     [36mreturn[39m crypto[33m.[39mcreateHash([32m"sha256"[39m)[33m.[39mupdate(token)[33m.[39mdigest([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 24 |[39m   }
     [90m 25 |[39m
     [90m 26 |[39m   [90m/**[39m[0m

      at Function.hashToken (src/services/refreshToken.service.ts:23:39)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:78:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ hashToken ‚Ä∫ should produce hash of correct length

    TypeError: Cannot read properties of undefined (reading 'update')

    [0m [90m 21 |[39m [90m   */[39m
     [90m 22 |[39m   [36mstatic[39m hashToken(token[33m:[39m string)[33m:[39m string {
    [31m[1m>[22m[39m[90m 23 |[39m     [36mreturn[39m crypto[33m.[39mcreateHash([32m"sha256"[39m)[33m.[39mupdate(token)[33m.[39mdigest([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                       [31m[1m^[22m[39m
     [90m 24 |[39m   }
     [90m 25 |[39m
     [90m 26 |[39m   [90m/**[39m[0m

      at Function.hashToken (src/services/refreshToken.service.ts:23:39)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:85:40)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ Token Security ‚Ä∫ should not store plain tokens in database

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:106:41)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ Token Security ‚Ä∫ should generate cryptographically secure tokens

    TypeError: Cannot read properties of undefined (reading 'toString')

    [0m [90m 14 |[39m [90m   */[39m
     [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
    [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
     [90m    |[39m                                  [31m[1m^[22m[39m
     [90m 17 |[39m   }
     [90m 18 |[39m
     [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:117:40)

  ‚óè RefreshTokenService - Unit Tests ‚Ä∫ Error Handling ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to create refresh token"
    Received message:   "Cannot read properties of undefined (reading 'toString')"

        [0m [90m 14 |[39m [90m   */[39m
         [90m 15 |[39m   [36mstatic[39m generateRefreshToken()[33m:[39m string {
        [31m[1m>[22m[39m[90m 16 |[39m     [36mreturn[39m crypto[33m.[39mrandomBytes([35m64[39m)[33m.[39mtoString([32m"hex"[39m)[33m;[39m
         [90m    |[39m                                  [31m[1m^[22m[39m
         [90m 17 |[39m   }
         [90m 18 |[39m
         [90m 19 |[39m   [90m/**[39m[0m

      at Function.generateRefreshToken (src/services/refreshToken.service.ts:16:34)
      at Function.createRefreshToken (src/services/refreshToken.service.ts:33:24)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:130:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/refreshToken.service.unit.test.ts:130:71)

FAIL src/__tests__/business-logic/bookkeeping.rules.test.ts
  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should validate a balanced transaction

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 40 |[39m
         [90m 41 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 42 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction)[33m,[39m
         [90m    |[39m                          [31m[1m^[22m[39m
         [90m 43 |[39m       )[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
         [90m 44 |[39m     })[33m;[39m
         [90m 45 |[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:42:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:43:13)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:43:13)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject transaction with less than 2 entries

    expect(received).toThrow(expected)

    Expected substring: "Transaction must have at least 2 entries"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 66 |[39m       }[33m;[39m
         [90m 67 |[39m
        [31m[1m>[22m[39m[90m 68 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m    |[39m                                     [31m[1m^[22m[39m
         [90m 69 |[39m         [32m"Transaction must have at least 2 entries"[39m[33m,[39m
         [90m 70 |[39m       )[33m;[39m
         [90m 71 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:68:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:68:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:68:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject entry that is both debit and credit

    expect(received).toThrow(expected)

    Expected substring: "Entry cannot be both debit and credit"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 115 |[39m       }[33m;[39m
         [90m 116 |[39m
        [31m[1m>[22m[39m[90m 117 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 118 |[39m         [32m"Entry cannot be both debit and credit"[39m[33m,[39m
         [90m 119 |[39m       )[33m;[39m
         [90m 120 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:117:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:117:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:117:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject unbalanced transaction

    expect(received).toThrow(expected)

    Expected substring: "Transaction is not balanced"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 153 |[39m       }[33m;[39m
         [90m 154 |[39m
        [31m[1m>[22m[39m[90m 155 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 156 |[39m         [32m"Transaction is not balanced"[39m[33m,[39m
         [90m 157 |[39m       )[33m;[39m
         [90m 158 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:155:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:155:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:155:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject entry that is both debit and credit

    expect(received).toThrow(expected)

    Expected substring: "Transaction is not balanced. Debits: 100, Credits: 200"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 191 |[39m       }[33m;[39m
         [90m 192 |[39m
        [31m[1m>[22m[39m[90m 193 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 194 |[39m         [32m"Transaction is not balanced. Debits: 100, Credits: 200"[39m[33m,[39m
         [90m 195 |[39m       )[33m;[39m
         [90m 196 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:193:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:193:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:193:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject entry that is neither debit nor credit

    expect(received).toThrow(expected)

    Expected substring: "Transaction is not balanced. Debits: 0, Credits: 100"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 229 |[39m       }[33m;[39m
         [90m 230 |[39m
        [31m[1m>[22m[39m[90m 231 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 232 |[39m         [32m"Transaction is not balanced. Debits: 0, Credits: 100"[39m[33m,[39m
         [90m 233 |[39m       )[33m;[39m
         [90m 234 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:231:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:231:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:231:71)

  ‚óè Bookkeeping Rules ‚Ä∫ validateDoubleEntry ‚Ä∫ should reject zero or negative amounts

    expect(received).toThrow(expected)

    Expected substring: "Entry amounts must be positive"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateDoubleEntry is not a function"

        [0m [90m 267 |[39m       }[33m;[39m
         [90m 268 |[39m
        [31m[1m>[22m[39m[90m 269 |[39m       expect(() [33m=>[39m [33mBookkeepingRules[39m[33m.[39mvalidateDoubleEntry(transaction))[33m.[39mtoThrow(
         [90m     |[39m                                     [31m[1m^[22m[39m
         [90m 270 |[39m         [32m"Entry amounts must be positive"[39m[33m,[39m
         [90m 271 |[39m       )[33m;[39m
         [90m 272 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:269:37
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:269:71)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:269:71)

  ‚óè Bookkeeping Rules ‚Ä∫ createTransferTransaction ‚Ä∫ should create a valid transfer transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.createTransferTransaction is not a function

    [0m [90m 275 |[39m   describe([32m"createTransferTransaction"[39m[33m,[39m () [33m=>[39m {
     [90m 276 |[39m     it([32m"should create a valid transfer transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 277 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateTransferTransaction(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 278 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 279 |[39m         [32m"acc2"[39m[33m,[39m
     [90m 280 |[39m         [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:277:44)

  ‚óè Bookkeeping Rules ‚Ä∫ createFeeTransaction ‚Ä∫ should create a valid fee transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.createFeeTransaction is not a function

    [0m [90m 310 |[39m   describe([32m"createFeeTransaction"[39m[33m,[39m () [33m=>[39m {
     [90m 311 |[39m     it([32m"should create a valid fee transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 312 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateFeeTransaction(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 313 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 314 |[39m         [35m5.5[39m[33m,[39m
     [90m 315 |[39m         [32m"fee-revenue"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:312:44)

  ‚óè Bookkeeping Rules ‚Ä∫ createInterestTransaction ‚Ä∫ should create a valid interest transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.createInterestTransaction is not a function

    [0m [90m 335 |[39m   describe([32m"createInterestTransaction"[39m[33m,[39m () [33m=>[39m {
     [90m 336 |[39m     it([32m"should create a valid interest transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 337 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateInterestTransaction(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 338 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 339 |[39m         [35m10.0[39m[33m,[39m
     [90m 340 |[39m         [32m"interest-payable"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:337:44)

  ‚óè Bookkeeping Rules ‚Ä∫ calculateBalance ‚Ä∫ should calculate account balance correctly

    TypeError: bookkeeping_rules_1.BookkeepingRules.calculateBalance is not a function

    [0m [90m 396 |[39m       ][33m;[39m
     [90m 397 |[39m
    [31m[1m>[22m[39m[90m 398 |[39m       [36mconst[39m balance [33m=[39m [33mBookkeepingRules[39m[33m.[39mcalculateBalance(entries[33m,[39m [32m"acc1"[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 399 |[39m
     [90m 400 |[39m       expect(balance[33m.[39maccountId)[33m.[39mtoBe([32m"acc1"[39m)[33m;[39m
     [90m 401 |[39m       expect(balance[33m.[39mdebitBalance)[33m.[39mtoBe([35m100[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:398:40)

  ‚óè Bookkeeping Rules ‚Ä∫ calculateBalance ‚Ä∫ should handle account with no entries

    TypeError: bookkeeping_rules_1.BookkeepingRules.calculateBalance is not a function

    [0m [90m 406 |[39m     it([32m"should handle account with no entries"[39m[33m,[39m () [33m=>[39m {
     [90m 407 |[39m       [36mconst[39m entries [33m=[39m [][33m;[39m
    [31m[1m>[22m[39m[90m 408 |[39m       [36mconst[39m balance [33m=[39m [33mBookkeepingRules[39m[33m.[39mcalculateBalance(entries[33m,[39m [32m"acc1"[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 409 |[39m
     [90m 410 |[39m       expect(balance[33m.[39mdebitBalance)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 411 |[39m       expect(balance[33m.[39mcreditBalance)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:408:40)

  ‚óè Bookkeeping Rules ‚Ä∫ validateAccountConstraints ‚Ä∫ should allow valid transaction

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "bookkeeping_rules_1.BookkeepingRules.validateAccountConstraints is not a function"

        [0m [90m 477 |[39m
         [90m 478 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 479 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateAccountConstraints(
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 480 |[39m           transaction[33m,[39m
         [90m 481 |[39m           accountBalances[33m,[39m
         [90m 482 |[39m           accountTypes[33m,[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:479:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:484:13)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:484:13)

  ‚óè Bookkeeping Rules ‚Ä∫ validateAccountConstraints ‚Ä∫ should reject insufficient funds in checking account

    expect(received).toThrow(expected)

    Expected substring: "Overdraft limit exceeded for account acc1"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateAccountConstraints is not a function"

        [0m [90m 547 |[39m
         [90m 548 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 549 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateAccountConstraints(
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 550 |[39m           transaction[33m,[39m
         [90m 551 |[39m           accountBalances[33m,[39m
         [90m 552 |[39m           accountTypes[33m,[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:549:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:554:9)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:554:9)

  ‚óè Bookkeeping Rules ‚Ä∫ validateAccountConstraints ‚Ä∫ should reject negative balance in savings account

    expect(received).toThrow(expected)

    Expected substring: "Insufficient funds in savings account acc1"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateAccountConstraints is not a function"

        [0m [90m 617 |[39m
         [90m 618 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 619 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateAccountConstraints(
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 620 |[39m           transaction[33m,[39m
         [90m 621 |[39m           accountBalances[33m,[39m
         [90m 622 |[39m           accountTypes[33m,[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:619:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:624:9)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:624:9)

  ‚óè Bookkeeping Rules ‚Ä∫ reverseTransaction ‚Ä∫ should create reversing transaction

    TypeError: bookkeeping_rules_1.BookkeepingRules.reverseTransaction is not a function

    [0m [90m 660 |[39m       }[33m;[39m
     [90m 661 |[39m
    [31m[1m>[22m[39m[90m 662 |[39m       [36mconst[39m reversal [33m=[39m [33mBookkeepingRules[39m[33m.[39mreverseTransaction(
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 663 |[39m         originalTransaction[33m,[39m
     [90m 664 |[39m         [32m"Customer request"[39m[33m,[39m
     [90m 665 |[39m         [32m"user1"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:662:41)

  ‚óè Bookkeeping Rules ‚Ä∫ validateTrialBalance ‚Ä∫ should validate balanced trial balance

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "bookkeeping_rules_1.BookkeepingRules.validateTrialBalance is not a function"

        [0m [90m 706 |[39m
         [90m 707 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 708 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateTrialBalance(accountBalances)[33m,[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 709 |[39m       )[33m.[39mnot[33m.[39mtoThrow()[33m;[39m
         [90m 710 |[39m     })[33m;[39m
         [90m 711 |[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:708:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:709:13)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:709:13)

  ‚óè Bookkeeping Rules ‚Ä∫ validateTrialBalance ‚Ä∫ should reject unbalanced trial balance

    expect(received).toThrow(expected)

    Expected substring: "Trial balance is not balanced"
    Received message:   "bookkeeping_rules_1.BookkeepingRules.validateTrialBalance is not a function"

        [0m [90m 729 |[39m
         [90m 730 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 731 |[39m         [33mBookkeepingRules[39m[33m.[39mvalidateTrialBalance(accountBalances)[33m,[39m
         [90m     |[39m                          [31m[1m^[22m[39m
         [90m 732 |[39m       )[33m.[39mtoThrow([32m"Trial balance is not balanced"[39m)[33m;[39m
         [90m 733 |[39m     })[33m;[39m
         [90m 734 |[39m   })[33m;[39m[0m

      at src/__tests__/business-logic/bookkeeping.rules.test.ts:731:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:732:9)
      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:732:9)

  ‚óè Bookkeeping Rules ‚Ä∫ createAdjustingEntry ‚Ä∫ should create adjusting entry with clearing account

    TypeError: bookkeeping_rules_1.BookkeepingRules.createAdjustingEntry is not a function

    [0m [90m 736 |[39m   describe([32m"createAdjustingEntry"[39m[33m,[39m () [33m=>[39m {
     [90m 737 |[39m     it([32m"should create adjusting entry with clearing account"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 738 |[39m       [36mconst[39m transaction [33m=[39m [33mBookkeepingRules[39m[33m.[39mcreateAdjustingEntry(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 739 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 740 |[39m         [35m100[39m[33m,[39m
     [90m 741 |[39m         [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:738:44)

  ‚óè TransactionTemplates ‚Ä∫ bankTransfer ‚Ä∫ should create bank transfer transaction

    TypeError: Cannot read properties of undefined (reading 'bankTransfer')

    [0m [90m 768 |[39m   describe([32m"bankTransfer"[39m[33m,[39m () [33m=>[39m {
     [90m 769 |[39m     it([32m"should create bank transfer transaction"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 770 |[39m       [36mconst[39m txn [33m=[39m [33mTransactionTemplates[39m[33m.[39mbankTransfer(
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 771 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 772 |[39m         [32m"acc2"[39m[33m,[39m
     [90m 773 |[39m         [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:770:40)

  ‚óè TransactionTemplates ‚Ä∫ atmWithdrawal ‚Ä∫ should create ATM withdrawal with fee

    TypeError: Cannot read properties of undefined (reading 'atmWithdrawal')

    [0m [90m 784 |[39m   describe([32m"atmWithdrawal"[39m[33m,[39m () [33m=>[39m {
     [90m 785 |[39m     it([32m"should create ATM withdrawal with fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 786 |[39m       [36mconst[39m result [33m=[39m [33mTransactionTemplates[39m[33m.[39matmWithdrawal(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 787 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 788 |[39m         [35m100[39m[33m,[39m
     [90m 789 |[39m         [35m2.5[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:786:43)

  ‚óè TransactionTemplates ‚Ä∫ interestBearingDeposit ‚Ä∫ should create deposit with interest

    TypeError: Cannot read properties of undefined (reading 'interestBearingDeposit')

    [0m [90m 801 |[39m   describe([32m"interestBearingDeposit"[39m[33m,[39m () [33m=>[39m {
     [90m 802 |[39m     it([32m"should create deposit with interest"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 803 |[39m       [36mconst[39m result [33m=[39m [33mTransactionTemplates[39m[33m.[39minterestBearingDeposit(
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 804 |[39m         [32m"acc1"[39m[33m,[39m
     [90m 805 |[39m         [35m1000[39m[33m,[39m
     [90m 806 |[39m         [35m5.0[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/bookkeeping.rules.test.ts:803:43)

FAIL src/__tests__/auth-service.test.ts
  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should register a new user successfully

    TypeError: Cannot read properties of undefined (reading 'create')

    [0m [90m 86 |[39m   expiresAt[33m.[39msetSeconds(expiresAt[33m.[39mgetSeconds() [33m+[39m [33mREFRESH_TOKEN_EXPIRES_IN[39m)[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m   [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mcreate({
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 89 |[39m     data[33m:[39m {
     [90m 90 |[39m       tokenHash[33m:[39m token[33m,[39m [90m// Store the token as hash[39m
     [90m 91 |[39m       userId[33m,[39m[0m

      at generateRefreshToken (src/services/auth.service.ts:88:29)
      at AuthService.generateAuthTokens (src/services/auth.service.ts:211:7)
      at AuthService.register (src/services/auth.service.ts:137:31)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:74:22)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should throw an error if user already exists

    expect(received).rejects.toThrow(expected)

    Expected substring: "User already exists"
    Received message:   "Email is already registered"

        [0m [90m 113 |[39m
         [90m 114 |[39m     [36mif[39m (existingUser) {
        [31m[1m>[22m[39m[90m 115 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m(
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 116 |[39m         [33mStatusCodes[39m[33m.[39m[33mBAD_REQUEST[39m[33m,[39m
         [90m 117 |[39m         [32m"Email is already registered"[39m[33m,[39m
         [90m 118 |[39m       )[33m;[39m[0m

      at AuthService.register (src/services/auth.service.ts:115:13)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:105:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:105:60)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should login a user with valid credentials

    TypeError: Cannot read properties of undefined (reading 'create')

    [0m [90m 86 |[39m   expiresAt[33m.[39msetSeconds(expiresAt[33m.[39mgetSeconds() [33m+[39m [33mREFRESH_TOKEN_EXPIRES_IN[39m)[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m   [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mcreate({
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 89 |[39m     data[33m:[39m {
     [90m 90 |[39m       tokenHash[33m:[39m token[33m,[39m [90m// Store the token as hash[39m
     [90m 91 |[39m       userId[33m,[39m[0m

      at generateRefreshToken (src/services/auth.service.ts:88:29)
      at AuthService.generateAuthTokens (src/services/auth.service.ts:211:7)
      at AuthService.login (src/services/auth.service.ts:174:31)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:133:22)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should throw an error for invalid credentials

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid credentials"
    Received message:   "Invalid email or password"

        [0m [90m 168 |[39m     )[33m;[39m
         [90m 169 |[39m     [36mif[39m ([33m![39misPasswordValid) {
        [31m[1m>[22m[39m[90m 170 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([33mStatusCodes[39m[33m.[39m[33mUNAUTHORIZED[39m[33m,[39m [32m"Invalid email or password"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 171 |[39m     }
         [90m 172 |[39m
         [90m 173 |[39m     [90m// Generate tokens[39m[0m

      at AuthService.login (src/services/auth.service.ts:170:13)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:167:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth-service.test.ts:167:60)

  ‚óè AuthService ‚Ä∫ getCurrentUser ‚Ä∫ should return the current user

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

    @@ -1,11 +1,14 @@
      Object {
        "select": Object {
          "createdAt": true,
          "email": true,
          "id": true,
    +     "isActive": true,
    +     "lastLogin": true,
          "name": true,
    +     "passwordChangedAt": true,
          "role": true,
          "updatedAt": true,
        },
        "where": Object {
          "id": 1,,

    Number of calls: 1

    [0m [90m 200 |[39m
     [90m 201 |[39m       [90m// Assert[39m
    [31m[1m>[22m[39m[90m 202 |[39m       expect(mockFindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 203 |[39m         where[33m:[39m { id[33m:[39m userId }[33m,[39m
     [90m 204 |[39m         select[33m:[39m {
     [90m 205 |[39m           id[33m:[39m [36mtrue[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth-service.test.ts:202:30)

FAIL src/__tests__/auth.controller.unit.test.ts
  ‚óè Auth Controller - Unit Tests ‚Ä∫ login ‚Ä∫ should login user and set refresh token cookie

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:108:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ login ‚Ä∫ should handle login failure

    TypeError: req.get is not a function

    [0m [90m 129 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 130 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 131 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 132 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 133 |[39m       details[33m:[39m {
     [90m 134 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Invalid credentials"[39m[33m,[39m[0m

      at login (src/controllers/auth.controller.ts:131:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:157:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ register ‚Ä∫ should register new user and set refresh token cookie

    TypeError: req.get is not a function

    [0m [90m 224 |[39m       email[33m:[39m req[33m.[39mbody[33m?[39m[33m.[39memail[33m,[39m
     [90m 225 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 226 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 227 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 228 |[39m       details[33m:[39m {
     [90m 229 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Registration failed"[39m[33m,[39m[0m

      at register (src/controllers/auth.controller.ts:226:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:209:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ refreshToken ‚Ä∫ should refresh access token with valid refresh token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"email": "test@example.com", "id": 1, "role": "USER"}

    Number of calls: 0

    [0m [90m 264 |[39m         mockNewRefreshToken[33m,[39m
     [90m 265 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 266 |[39m       expect(mockAuthService[33m.[39mgenerateAccessToken)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                   [31m[1m^[22m[39m
     [90m 267 |[39m         mockUser[33m,[39m
     [90m 268 |[39m       )[33m;[39m
     [90m 269 |[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:266:51)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ logout ‚Ä∫ should logout user and clear refresh token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-refresh-token"

    Number of calls: 0

    [0m [90m 352 |[39m       expect(
     [90m 353 |[39m         mockRefreshTokenService[33m.[39minvalidateRefreshToken[33m,[39m
    [31m[1m>[22m[39m[90m 354 |[39m       )[33m.[39mtoHaveBeenCalledWith(mockRefreshToken)[33m;[39m
     [90m     |[39m         [31m[1m^[22m[39m
     [90m 355 |[39m       expect(mockResponse[33m.[39mclearCookie)[33m.[39mtoHaveBeenCalledWith(
     [90m 356 |[39m         [32m"refreshToken"[39m[33m,[39m
     [90m 357 |[39m         expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:354:9)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ logoutAll ‚Ä∫ should logout user from all sessions

    TypeError: logoutAll is not a function

    [0m [90m 395 |[39m       )[33m;[39m
     [90m 396 |[39m
    [31m[1m>[22m[39m[90m 397 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 398 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 399 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 400 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:397:13)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ logoutAll ‚Ä∫ should require authentication

    TypeError: logoutAll is not a function

    [0m [90m 424 |[39m       mockRequest[33m.[39muser [33m=[39m undefined[33m;[39m
     [90m 425 |[39m
    [31m[1m>[22m[39m[90m 426 |[39m       [36mawait[39m logoutAll(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 427 |[39m         mockRequest [36mas[39m [33mRequest[39m[33m,[39m
     [90m 428 |[39m         mockResponse [36mas[39m [33mResponse[39m[33m,[39m
     [90m 429 |[39m         nextFunction[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:426:13)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ changePassword ‚Ä∫ should change password and invalidate all refresh tokens

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:454:7)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ changePassword ‚Ä∫ should require authentication

    TypeError: req.get is not a function

    [0m [90m 373 |[39m       email[33m:[39m req[33m.[39muser[33m?[39m[33m.[39memail [33m||[39m [36mnull[39m[33m,[39m
     [90m 374 |[39m       ip[33m:[39m req[33m.[39mip[33m,[39m
    [31m[1m>[22m[39m[90m 375 |[39m       userAgent[33m:[39m req[33m.[39m[36mget[39m([32m"User-Agent"[39m)[33m,[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 376 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 377 |[39m       details[33m:[39m {
     [90m 378 |[39m         reason[33m:[39m (error [36mas[39m [33mError[39m)[33m.[39mmessage [33m||[39m [32m"Password change failed"[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:375:22)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:489:13)

  ‚óè Auth Controller - Unit Tests ‚Ä∫ changePassword ‚Ä∫ should validate password format

    Validation failed

    [0m [90m 358 |[39m   } [36mcatch[39m (error) {
     [90m 359 |[39m     [36mif[39m (error [36minstanceof[39m z[33m.[39m[33mZodError[39m) {
    [31m[1m>[22m[39m[90m 360 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 361 |[39m         [32m"Validation failed"[39m[33m,[39m
     [90m 362 |[39m         [33mStatusCodes[39m[33m.[39m[33mBAD_REQUEST[39m[33m,[39m
     [90m 363 |[39m         [33mErrorCodes[39m[33m.[39m[33mVALIDATION_ERROR[39m[33m,[39m[0m

      at changePassword (src/controllers/auth.controller.ts:360:13)
      at Object.<anonymous> (src/__tests__/auth.controller.unit.test.ts:510:13)

FAIL src/__tests__/business-logic/financial.calculator.test.ts
  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should convert currency correctly

    TypeError: financial_calculator_1.FinancialCalculator.convertCurrency is not a function

    [0m [90m  7 |[39m   describe([32m"convertCurrency"[39m[33m,[39m () [33m=>[39m {
     [90m  8 |[39m     it([32m"should convert currency correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m  9 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mconvertCurrency(
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 10 |[39m         [35m100[39m[33m,[39m
     [90m 11 |[39m         [32m"USD"[39m[33m,[39m
     [90m 12 |[39m         [32m"EUR"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:9:42)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should round to correct precision

    TypeError: financial_calculator_1.FinancialCalculator.convertCurrency is not a function

    [0m [90m 17 |[39m
     [90m 18 |[39m     it([32m"should round to correct precision"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 19 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mconvertCurrency(
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 20 |[39m         [35m100[39m[33m,[39m
     [90m 21 |[39m         [32m"USD"[39m[33m,[39m
     [90m 22 |[39m         [32m"JPY"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:19:42)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should reject negative amounts

    expect(received).toThrow(expected)

    Expected substring: "Cannot convert negative amounts"
    Received message:   "financial_calculator_1.FinancialCalculator.convertCurrency is not a function"

        [0m [90m 28 |[39m     it([32m"should reject negative amounts"[39m[33m,[39m () [33m=>[39m {
         [90m 29 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 30 |[39m         [33mFinancialCalculator[39m[33m.[39mconvertCurrency([33m-[39m[35m100[39m[33m,[39m [32m"USD"[39m[33m,[39m [32m"EUR"[39m[33m,[39m [35m0.85[39m)[33m,[39m
         [90m    |[39m                             [31m[1m^[22m[39m
         [90m 31 |[39m       )[33m.[39mtoThrow([32m"Cannot convert negative amounts"[39m)[33m;[39m
         [90m 32 |[39m     })[33m;[39m
         [90m 33 |[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:30:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:31:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:31:9)

  ‚óè Financial Calculator ‚Ä∫ convertCurrency ‚Ä∫ should reject zero or negative exchange rate

    expect(received).toThrow(expected)

    Expected substring: "Exchange rate must be positive"
    Received message:   "financial_calculator_1.FinancialCalculator.convertCurrency is not a function"

        [0m [90m 34 |[39m     it([32m"should reject zero or negative exchange rate"[39m[33m,[39m () [33m=>[39m {
         [90m 35 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 36 |[39m         [33mFinancialCalculator[39m[33m.[39mconvertCurrency([35m100[39m[33m,[39m [32m"USD"[39m[33m,[39m [32m"EUR"[39m[33m,[39m [35m0[39m)[33m,[39m
         [90m    |[39m                             [31m[1m^[22m[39m
         [90m 37 |[39m       )[33m.[39mtoThrow([32m"Exchange rate must be positive"[39m)[33m;[39m
         [90m 38 |[39m
         [90m 39 |[39m       expect(() [33m=>[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:36:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:37:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:37:9)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should calculate tax correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateTax is not a function

    [0m [90m 45 |[39m   describe([32m"calculateTax"[39m[33m,[39m () [33m=>[39m {
     [90m 46 |[39m     it([32m"should calculate tax correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 47 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([35m100[39m[33m,[39m [35m0.08[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 48 |[39m       expect(result)[33m.[39mtoEqual({
     [90m 49 |[39m         amount[33m:[39m [35m100[39m[33m,[39m
     [90m 50 |[39m         taxRate[33m:[39m [35m0.08[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:47:42)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should handle zero tax rate

    TypeError: financial_calculator_1.FinancialCalculator.calculateTax is not a function

    [0m [90m 56 |[39m
     [90m 57 |[39m     it([32m"should handle zero tax rate"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 58 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([35m100[39m[33m,[39m [35m0[39m)[33m;[39m
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 59 |[39m       expect(result)[33m.[39mtoEqual({
     [90m 60 |[39m         amount[33m:[39m [35m100[39m[33m,[39m
     [90m 61 |[39m         taxRate[33m:[39m [35m0[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:58:42)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should reject negative amounts

    expect(received).toThrow(expected)

    Expected substring: "Cannot calculate tax on negative amount"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateTax is not a function"

        [0m [90m 67 |[39m
         [90m 68 |[39m     it([32m"should reject negative amounts"[39m[33m,[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 69 |[39m       expect(() [33m=>[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([33m-[39m[35m100[39m[33m,[39m [35m0.08[39m))[33m.[39mtoThrow(
         [90m    |[39m                                        [31m[1m^[22m[39m
         [90m 70 |[39m         [32m"Cannot calculate tax on negative amount"[39m[33m,[39m
         [90m 71 |[39m       )[33m;[39m
         [90m 72 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:69:40
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:69:66)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:69:66)

  ‚óè Financial Calculator ‚Ä∫ calculateTax ‚Ä∫ should reject tax rate outside 0-1 range

    expect(received).toThrow(expected)

    Expected substring: "Tax rate must be between 0 and 1 (0-100%)"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateTax is not a function"

        [0m [90m 73 |[39m
         [90m 74 |[39m     it([32m"should reject tax rate outside 0-1 range"[39m[33m,[39m () [33m=>[39m {
        [31m[1m>[22m[39m[90m 75 |[39m       expect(() [33m=>[39m [33mFinancialCalculator[39m[33m.[39mcalculateTax([35m100[39m[33m,[39m [33m-[39m[35m0.1[39m))[33m.[39mtoThrow(
         [90m    |[39m                                        [31m[1m^[22m[39m
         [90m 76 |[39m         [32m"Tax rate must be between 0 and 1 (0-100%)"[39m[33m,[39m
         [90m 77 |[39m       )[33m;[39m
         [90m 78 |[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:75:40
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:75:65)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:75:65)

  ‚óè Financial Calculator ‚Ä∫ calculateInterest ‚Ä∫ should calculate compound interest correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateInterest is not a function

    [0m [90m 85 |[39m   describe([32m"calculateInterest"[39m[33m,[39m () [33m=>[39m {
     [90m 86 |[39m     it([32m"should calculate compound interest correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 87 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateInterest(
     [90m    |[39m                                          [31m[1m^[22m[39m
     [90m 88 |[39m         [35m1000[39m[33m,[39m
     [90m 89 |[39m         [35m0.05[39m[33m,[39m
     [90m 90 |[39m         [35m365[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:87:42)

  ‚óè Financial Calculator ‚Ä∫ calculateInterest ‚Ä∫ should calculate simple interest correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateSimpleInterest is not a function

    [0m [90m  96 |[39m
     [90m  97 |[39m     it([32m"should calculate simple interest correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m  98 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateSimpleInterest(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m  99 |[39m         [35m1000[39m[33m,[39m
     [90m 100 |[39m         [35m0.05[39m[33m,[39m
     [90m 101 |[39m         [35m365[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:98:42)

  ‚óè Financial Calculator ‚Ä∫ calculateInterest ‚Ä∫ should reject negative parameters

    expect(received).toThrow(expected)

    Expected substring: "Principal cannot be negative"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateInterest is not a function"

        [0m [90m 107 |[39m     it([32m"should reject negative parameters"[39m[33m,[39m () [33m=>[39m {
         [90m 108 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 109 |[39m         [33mFinancialCalculator[39m[33m.[39mcalculateInterest([33m-[39m[35m1000[39m[33m,[39m [35m0.05[39m[33m,[39m [35m365[39m)[33m,[39m
         [90m     |[39m                             [31m[1m^[22m[39m
         [90m 110 |[39m       )[33m.[39mtoThrow([32m"Principal cannot be negative"[39m)[33m;[39m
         [90m 111 |[39m
         [90m 112 |[39m       expect(() [33m=>[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:109:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:110:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:110:9)

  ‚óè Financial Calculator ‚Ä∫ calculateBalanceSummary ‚Ä∫ should calculate balance summary correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateBalanceSummary is not a function

    [0m [90m 122 |[39m   describe([32m"calculateBalanceSummary"[39m[33m,[39m () [33m=>[39m {
     [90m 123 |[39m     it([32m"should calculate balance summary correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 124 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateBalanceSummary(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 125 |[39m         [35m1000[39m[33m,[39m
     [90m 126 |[39m         [35m200[39m[33m,[39m
     [90m 127 |[39m         [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:124:42)

  ‚óè Financial Calculator ‚Ä∫ calculateBalanceSummary ‚Ä∫ should handle zero pending amounts

    TypeError: financial_calculator_1.FinancialCalculator.calculateBalanceSummary is not a function

    [0m [90m 138 |[39m
     [90m 139 |[39m     it([32m"should handle zero pending amounts"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 140 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateBalanceSummary([35m1000[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 141 |[39m       expect(result[33m.[39mavailableBalance)[33m.[39mtoBe([35m1000[39m)[33m;[39m
     [90m 142 |[39m     })[33m;[39m
     [90m 143 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:140:42)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should calculate fixed fee only

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 145 |[39m   describe([32m"calculateTransactionFee"[39m[33m,[39m () [33m=>[39m {
     [90m 146 |[39m     it([32m"should calculate fixed fee only"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 147 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m100[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 148 |[39m         fixedFee[33m:[39m [35m2.5[39m[33m,[39m
     [90m 149 |[39m       })[33m;[39m
     [90m 150 |[39m       expect(fee)[33m.[39mtoBe([35m2.5[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:147:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should calculate percentage fee only

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 152 |[39m
     [90m 153 |[39m     it([32m"should calculate percentage fee only"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 154 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m100[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 155 |[39m         percentageFee[33m:[39m [35m0.02[39m[33m,[39m
     [90m 156 |[39m       })[33m;[39m
     [90m 157 |[39m       expect(fee)[33m.[39mtoBe([35m2.0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:154:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should calculate combined fee

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 159 |[39m
     [90m 160 |[39m     it([32m"should calculate combined fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 161 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m100[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 162 |[39m         fixedFee[33m:[39m [35m1.0[39m[33m,[39m
     [90m 163 |[39m         percentageFee[33m:[39m [35m0.02[39m[33m,[39m
     [90m 164 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:161:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should apply minimum fee

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 167 |[39m
     [90m 168 |[39m     it([32m"should apply minimum fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 169 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m10[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 170 |[39m         fixedFee[33m:[39m [35m0.5[39m[33m,[39m
     [90m 171 |[39m         percentageFee[33m:[39m [35m0.01[39m[33m,[39m
     [90m 172 |[39m         minFee[33m:[39m [35m2.0[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:169:39)

  ‚óè Financial Calculator ‚Ä∫ calculateTransactionFee ‚Ä∫ should apply maximum fee

    TypeError: financial_calculator_1.FinancialCalculator.calculateTransactionFee is not a function

    [0m [90m 176 |[39m
     [90m 177 |[39m     it([32m"should apply maximum fee"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 178 |[39m       [36mconst[39m fee [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateTransactionFee([35m10000[39m[33m,[39m {
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 179 |[39m         percentageFee[33m:[39m [35m0.05[39m[33m,[39m
     [90m 180 |[39m         maxFee[33m:[39m [35m25.0[39m[33m,[39m
     [90m 181 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:178:39)

  ‚óè Financial Calculator ‚Ä∫ calculateConversionWithSpread ‚Ä∫ should calculate conversion with spread

    TypeError: financial_calculator_1.FinancialCalculator.calculateConversionWithSpread is not a function

    [0m [90m 186 |[39m   describe([32m"calculateConversionWithSpread"[39m[33m,[39m () [33m=>[39m {
     [90m 187 |[39m     it([32m"should calculate conversion with spread"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 188 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateConversionWithSpread(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 189 |[39m         [35m100[39m[33m,[39m
     [90m 190 |[39m         [35m1.2[39m[33m,[39m
     [90m 191 |[39m         [35m0.02[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:188:42)

  ‚óè Financial Calculator ‚Ä∫ calculateMonthlyPayment ‚Ä∫ should calculate loan payment correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateMonthlyPayment is not a function

    [0m [90m 199 |[39m   describe([32m"calculateMonthlyPayment"[39m[33m,[39m () [33m=>[39m {
     [90m 200 |[39m     it([32m"should calculate loan payment correctly"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 201 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateMonthlyPayment(
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 202 |[39m         [35m100000[39m[33m,[39m
     [90m 203 |[39m         [35m0.05[39m[33m,[39m
     [90m 204 |[39m         [35m360[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:201:42)

  ‚óè Financial Calculator ‚Ä∫ calculateMonthlyPayment ‚Ä∫ should handle zero interest loan

    TypeError: financial_calculator_1.FinancialCalculator.calculateMonthlyPayment is not a function

    [0m [90m 210 |[39m
     [90m 211 |[39m     it([32m"should handle zero interest loan"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 212 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateMonthlyPayment([35m12000[39m[33m,[39m [35m0[39m[33m,[39m [35m12[39m)[33m;[39m
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 213 |[39m       expect(result[33m.[39mmonthlyPayment)[33m.[39mtoBe([35m1000.0[39m)[33m;[39m
     [90m 214 |[39m       expect(result[33m.[39mtotalPayment)[33m.[39mtoBe([35m12000.0[39m)[33m;[39m
     [90m 215 |[39m       expect(result[33m.[39mtotalInterest)[33m.[39mtoBe([35m0.0[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:212:42)

  ‚óè Financial Calculator ‚Ä∫ calculateMonthlyPayment ‚Ä∫ should reject invalid parameters

    expect(received).toThrow(expected)

    Expected substring: "Invalid loan parameters"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateMonthlyPayment is not a function"

        [0m [90m 218 |[39m     it([32m"should reject invalid parameters"[39m[33m,[39m () [33m=>[39m {
         [90m 219 |[39m       expect(() [33m=>[39m
        [31m[1m>[22m[39m[90m 220 |[39m         [33mFinancialCalculator[39m[33m.[39mcalculateMonthlyPayment([33m-[39m[35m1000[39m[33m,[39m [35m0.05[39m[33m,[39m [35m360[39m)[33m,[39m
         [90m     |[39m                             [31m[1m^[22m[39m
         [90m 221 |[39m       )[33m.[39mtoThrow([32m"Invalid loan parameters"[39m)[33m;[39m
         [90m 222 |[39m
         [90m 223 |[39m       expect(() [33m=>[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:220:29
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:221:9)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:221:9)

  ‚óè Financial Calculator ‚Ä∫ calculateAmortizationSchedule ‚Ä∫ should generate amortization schedule

    TypeError: financial_calculator_1.FinancialCalculator.calculateAmortizationSchedule is not a function

    [0m [90m 233 |[39m   describe([32m"calculateAmortizationSchedule"[39m[33m,[39m () [33m=>[39m {
     [90m 234 |[39m     it([32m"should generate amortization schedule"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 235 |[39m       [36mconst[39m schedule [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateAmortizationSchedule(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 236 |[39m         [35m1000[39m[33m,[39m
     [90m 237 |[39m         [35m0.12[39m[33m,[39m
     [90m 238 |[39m         [35m12[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:235:44)

  ‚óè Financial Calculator ‚Ä∫ calculateNPV ‚Ä∫ should calculate NPV correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateNPV is not a function

    [0m [90m 258 |[39m     it([32m"should calculate NPV correctly"[39m[33m,[39m () [33m=>[39m {
     [90m 259 |[39m       [36mconst[39m cashFlows [33m=[39m [[33m-[39m[35m1000[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m][33m;[39m
    [31m[1m>[22m[39m[90m 260 |[39m       [36mconst[39m npv [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateNPV(cashFlows[33m,[39m [35m0.1[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 261 |[39m       expect(npv)[33m.[39mtoBeCloseTo([33m-[39m[35m49.04[39m[33m,[39m [35m2[39m)[33m;[39m
     [90m 262 |[39m     })[33m;[39m
     [90m 263 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:260:39)

  ‚óè Financial Calculator ‚Ä∫ calculateIRR ‚Ä∫ should calculate IRR correctly

    TypeError: financial_calculator_1.FinancialCalculator.calculateIRR is not a function

    [0m [90m 266 |[39m     it([32m"should calculate IRR correctly"[39m[33m,[39m () [33m=>[39m {
     [90m 267 |[39m       [36mconst[39m cashFlows [33m=[39m [[33m-[39m[35m1000[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m[33m,[39m [35m300[39m][33m;[39m
    [31m[1m>[22m[39m[90m 268 |[39m       [36mconst[39m irr [33m=[39m [33mFinancialCalculator[39m[33m.[39mcalculateIRR(cashFlows[33m,[39m [35m0.1[39m)[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 269 |[39m       expect(irr)[33m.[39mtoBeCloseTo([35m0.0771[39m[33m,[39m [35m4[39m)[33m;[39m
     [90m 270 |[39m     })[33m;[39m
     [90m 271 |[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:268:39)

  ‚óè Financial Calculator ‚Ä∫ calculateIRR ‚Ä∫ should throw if IRR calculation fails to converge

    expect(received).toThrow(expected)

    Expected substring: "IRR calculation failed to converge"
    Received message:   "financial_calculator_1.FinancialCalculator.calculateIRR is not a function"

        [0m [90m 272 |[39m     it([32m"should throw if IRR calculation fails to converge"[39m[33m,[39m () [33m=>[39m {
         [90m 273 |[39m       [36mconst[39m cashFlows [33m=[39m [[35m0[39m][33m;[39m [90m// Single zero - won't converge[39m
        [31m[1m>[22m[39m[90m 274 |[39m       expect(() [33m=>[39m [33mFinancialCalculator[39m[33m.[39mcalculateIRR(cashFlows))[33m.[39mtoThrow(
         [90m     |[39m                                        [31m[1m^[22m[39m
         [90m 275 |[39m         [32m"IRR calculation failed to converge"[39m[33m,[39m
         [90m 276 |[39m       )[33m;[39m
         [90m 277 |[39m     })[33m;[39m[0m

      at src/__tests__/business-logic/financial.calculator.test.ts:274:40
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:274:65)
      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:274:65)

  ‚óè FinancialCalculations ‚Ä∫ convertCurrency ‚Ä∫ should be an alias to FinancialCalculator.convertCurrency

    TypeError: Cannot read properties of undefined (reading 'convertCurrency')

    [0m [90m 282 |[39m   describe([32m"convertCurrency"[39m[33m,[39m () [33m=>[39m {
     [90m 283 |[39m     it([32m"should be an alias to FinancialCalculator.convertCurrency"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 284 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mconvertCurrency(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 285 |[39m         [35m100[39m[33m,[39m
     [90m 286 |[39m         [32m"USD"[39m[33m,[39m
     [90m 287 |[39m         [32m"EUR"[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:284:44)

  ‚óè FinancialCalculations ‚Ä∫ calculateTotalWithFees ‚Ä∫ should calculate total with fees

    TypeError: Cannot read properties of undefined (reading 'calculateTotalWithFees')

    [0m [90m 294 |[39m   describe([32m"calculateTotalWithFees"[39m[33m,[39m () [33m=>[39m {
     [90m 295 |[39m     it([32m"should calculate total with fees"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 296 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mcalculateTotalWithFees([35m100[39m[33m,[39m {
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 297 |[39m         fixedFee[33m:[39m [35m2.5[39m[33m,[39m
     [90m 298 |[39m         percentageFee[33m:[39m [35m0.01[39m[33m,[39m
     [90m 299 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:296:44)

  ‚óè FinancialCalculations ‚Ä∫ calculateTotalWithFees ‚Ä∫ should handle no fees

    TypeError: Cannot read properties of undefined (reading 'calculateTotalWithFees')

    [0m [90m 307 |[39m
     [90m 308 |[39m     it([32m"should handle no fees"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 309 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mcalculateTotalWithFees([35m100[39m[33m,[39m {})[33m;[39m
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 310 |[39m
     [90m 311 |[39m       expect(result)[33m.[39mtoEqual({
     [90m 312 |[39m         subtotal[33m:[39m [35m100[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:309:44)

  ‚óè FinancialCalculations ‚Ä∫ calculateLoanDetails ‚Ä∫ should provide complete loan details

    TypeError: Cannot read properties of undefined (reading 'calculateLoanDetails')

    [0m [90m 319 |[39m   describe([32m"calculateLoanDetails"[39m[33m,[39m () [33m=>[39m {
     [90m 320 |[39m     it([32m"should provide complete loan details"[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 321 |[39m       [36mconst[39m result [33m=[39m [33mFinancialCalculations[39m[33m.[39mcalculateLoanDetails(
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 322 |[39m         [35m100000[39m[33m,[39m
     [90m 323 |[39m         [35m0.05[39m[33m,[39m
     [90m 324 |[39m         [35m360[39m[33m,[39m[0m

      at Object.<anonymous> (src/__tests__/business-logic/financial.calculator.test.ts:321:44)

FAIL src/__tests__/auth.test.ts
  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should register a new user successfully

    TypeError: bcryptjs_1.default.genSalt is not a function

    [0m [90m 120 |[39m
     [90m 121 |[39m     [90m// Hash password with salt[39m
    [31m[1m>[22m[39m[90m 122 |[39m     [36mconst[39m salt [33m=[39m [36mawait[39m bcrypt[33m.[39mgenSalt([35m10[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 123 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash(userData[33m.[39mpassword[33m,[39m salt)[33m;[39m
     [90m 124 |[39m
     [90m 125 |[39m     [90m// Create user[39m[0m

      at AuthService.register (src/services/auth.service.ts:122:31)
      at Object.<anonymous> (src/__tests__/auth.test.ts:96:18)

FAIL src/__tests__/auth.service.test.ts
  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should register a new user successfully

    TypeError: bcryptjs_1.default.genSalt is not a function

    [0m [90m 120 |[39m
     [90m 121 |[39m     [90m// Hash password with salt[39m
    [31m[1m>[22m[39m[90m 122 |[39m     [36mconst[39m salt [33m=[39m [36mawait[39m bcrypt[33m.[39mgenSalt([35m10[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 123 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash(userData[33m.[39mpassword[33m,[39m salt)[33m;[39m
     [90m 124 |[39m
     [90m 125 |[39m     [90m// Create user[39m[0m

      at AuthService.register (src/services/auth.service.ts:122:31)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:103:22)

  ‚óè AuthService ‚Ä∫ register ‚Ä∫ should throw an error if user already exists

    expect(received).rejects.toThrow(expected)

    Expected substring: "User already exists"
    Received message:   "Email is already registered"

        [0m [90m 113 |[39m
         [90m 114 |[39m     [36mif[39m (existingUser) {
        [31m[1m>[22m[39m[90m 115 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m(
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 116 |[39m         [33mStatusCodes[39m[33m.[39m[33mBAD_REQUEST[39m[33m,[39m
         [90m 117 |[39m         [32m"Email is already registered"[39m[33m,[39m
         [90m 118 |[39m       )[33m;[39m[0m

      at AuthService.register (src/services/auth.service.ts:115:13)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:139:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:139:60)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should login a user with valid credentials

    TypeError: Cannot read properties of undefined (reading 'create')

    [0m [90m 86 |[39m   expiresAt[33m.[39msetSeconds(expiresAt[33m.[39mgetSeconds() [33m+[39m [33mREFRESH_TOKEN_EXPIRES_IN[39m)[33m;[39m
     [90m 87 |[39m
    [31m[1m>[22m[39m[90m 88 |[39m   [36mawait[39m prisma[33m.[39mrefreshToken[33m.[39mcreate({
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 89 |[39m     data[33m:[39m {
     [90m 90 |[39m       tokenHash[33m:[39m token[33m,[39m [90m// Store the token as hash[39m
     [90m 91 |[39m       userId[33m,[39m[0m

      at generateRefreshToken (src/services/auth.service.ts:88:29)
      at AuthService.generateAuthTokens (src/services/auth.service.ts:211:7)
      at AuthService.login (src/services/auth.service.ts:174:31)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:180:22)

  ‚óè AuthService ‚Ä∫ login ‚Ä∫ should throw an error for invalid credentials

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid credentials"
    Received message:   "Invalid email or password"

        [0m [90m 168 |[39m     )[33m;[39m
         [90m 169 |[39m     [36mif[39m ([33m![39misPasswordValid) {
        [31m[1m>[22m[39m[90m 170 |[39m       [36mthrow[39m [36mnew[39m [33mApiError[39m([33mStatusCodes[39m[33m.[39m[33mUNAUTHORIZED[39m[33m,[39m [32m"Invalid email or password"[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 171 |[39m     }
         [90m 172 |[39m
         [90m 173 |[39m     [90m// Generate tokens[39m[0m

      at AuthService.login (src/services/auth.service.ts:170:13)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:221:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/__tests__/auth.service.test.ts:221:60)

FAIL src/__tests__/integration/mail/test.module.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/utils/performance.test.ts
  ‚óè Test suite failed to run

    Cannot find module './logger.js' from 'src/utils/cacheEngine.ts'

    Require stack:
      src/utils/cacheEngine.ts
      src/__tests__/utils/performance.test.ts

    [0m [90m 1 |[39m [36mimport[39m [33mRedis[39m [36mfrom[39m [32m"ioredis"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { logger } [36mfrom[39m [32m"./logger.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m
     [90m 4 |[39m [90m/**[39m
     [90m 5 |[39m [90m * Redis caching engine with intelligent invalidation[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/utils/cacheEngine.ts:2:1)
      at Object.<anonymous> (src/__tests__/utils/performance.test.ts:9:1)

FAIL src/__tests__/security/databaseSecurity.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../constants/roles.js' from 'src/services/databaseSecurity.service.ts'

    Require stack:
      src/services/databaseSecurity.service.ts
      src/__tests__/security/databaseSecurity.test.ts

    [0m [90m 2 |[39m [90m// @ts-ignore[39m
     [90m 3 |[39m [36mimport[39m { [33mPrismaClient[39m } [36mfrom[39m [32m"@prisma/client"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 4 |[39m [36mimport[39m { [33mROLES[39m[33m,[39m [33mROLES_HIERARCHY[39m } [36mfrom[39m [32m"../constants/roles.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 5 |[39m
     [90m 6 |[39m [36mconst[39m prisma [33m=[39m [33mPrismaClientSingleton[39m[33m.[39mgetInstance()[33m;[39m
     [90m 7 |[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/services/databaseSecurity.service.ts:4:1)
      at Object.<anonymous> (src/__tests__/security/databaseSecurity.test.ts:3:1)

FAIL src/__tests__/security/security.middleware.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../middleware/security' from 'src/__tests__/security/security.middleware.test.ts'

    [0m [90m 1 |[39m [36mimport[39m request [36mfrom[39m [32m"supertest"[39m[33m;[39m
     [90m 2 |[39m [36mimport[39m express [36mfrom[39m [32m"express"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 3 |[39m [36mimport[39m applySecurityMiddlewares[33m,[39m {
     [90m   |[39m [31m[1m^[22m[39m
     [90m 4 |[39m   authRateLimiter[33m,[39m
     [90m 5 |[39m   sensitiveRouteLimiter[33m,[39m
     [90m 6 |[39m } [36mfrom[39m [32m"../../middleware/security"[39m[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/security/security.middleware.test.ts:3:1)

FAIL src/__tests__/security/auditLogger.integration.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../middleware/security/auditLogger.middleware.js' from 'src/__tests__/security/auditLogger.integration.test.ts'

    [0m [90m 47 |[39m   logAllRequests[33m,[39m
     [90m 48 |[39m   logPerformance[33m,[39m
    [31m[1m>[22m[39m[90m 49 |[39m } [33m=[39m require([32m"../../middleware/security/auditLogger.middleware.js"[39m)[33m;[39m
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 50 |[39m
     [90m 51 |[39m describe([32m"Audit Logger Integration Tests"[39m[33m,[39m () [33m=>[39m {
     [90m 52 |[39m   [36mlet[39m app[33m:[39m express[33m.[39m[33mApplication[39m[33m;[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/security/auditLogger.integration.test.ts:49:5)

FAIL src/__tests__/security/auditLogger.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../middleware/security/auditLogger.middleware.js' from 'src/__tests__/security/auditLogger.test.ts'

    [0m [90m 3 |[39m [36mimport[39m [33mAuditLoggerService[39m [36mfrom[39m [32m"../../services/auditLogger.service"[39m[33m;[39m
     [90m 4 |[39m [36mimport[39m [33mMonitoringService[39m [36mfrom[39m [32m"../../services/monitoring.service"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 5 |[39m [36mimport[39m {
     [90m   |[39m [31m[1m^[22m[39m
     [90m 6 |[39m   logAuthEvent[33m,[39m
     [90m 7 |[39m   logDataEvent[33m,[39m
     [90m 8 |[39m   logSecurityEvent[33m,[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/security/auditLogger.test.ts:5:1)

FAIL src/__tests__/integration/invoice.service.integration.test.ts
  ‚óè Test suite failed to run

    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m82[0m:[93m7[0m - [91merror[0m[90m TS1109: [0mExpression expected.

    [7m82[0m       };
    [7m  [0m [91m      ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m83[0m:[93m5[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m83[0m     }),
    [7m  [0m [91m    ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m83[0m:[93m6[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m83[0m     }),
    [7m  [0m [91m     ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m83[0m:[93m7[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m83[0m     }),
    [7m  [0m [91m      ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m84[0m:[93m3[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m84[0m   };
    [7m  [0m [91m  ~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m85[0m:[93m1[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m85[0m });
    [7m  [0m [91m~[0m
    [96msrc/__tests__/integration/invoice.service.integration.test.ts[0m:[93m85[0m:[93m2[0m - [91merror[0m[90m TS1128: [0mDeclaration or statement expected.

    [7m85[0m });
    [7m  [0m [91m ~[0m

FAIL src/__tests__/business-logic/domain.validator.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../utils/errorHandler.js' from 'src/business-logic/validators/domain.validator.ts'

    Require stack:
      src/business-logic/validators/domain.validator.ts
      src/__tests__/business-logic/domain.validator.test.ts

    [0m[31m[1m>[22m[39m[90m 1 |[39m [36mimport[39m { [33mApiError[39m[33m,[39m [33mErrorCodes[39m } [36mfrom[39m [32m"../../utils/errorHandler.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 2 |[39m
     [90m 3 |[39m [90m/**[39m
     [90m 4 |[39m [90m * Domain validation framework for financial operations[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/business-logic/validators/domain.validator.ts:1:1)
      at Object.<anonymous> (src/__tests__/business-logic/domain.validator.test.ts:1:1)

FAIL src/__tests__/business-logic/fraud.detector.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../utils/logger.js' from 'src/business-logic/anti-fraud/fraud.detector.ts'

    Require stack:
      src/business-logic/anti-fraud/fraud.detector.ts
      src/__tests__/business-logic/fraud.detector.test.ts

    [0m [90m 1 |[39m [36mimport[39m { [33mApiError[39m[33m,[39m [33mErrorCodes[39m } [36mfrom[39m [32m"../../utils/errorHandler.js"[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { logger } [36mfrom[39m [32m"../../utils/logger.js"[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m
     [90m 4 |[39m [90m/**[39m
     [90m 5 |[39m [90m * Anti-fraud detection system[39m[0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/business-logic/anti-fraud/fraud.detector.ts:2:1)
      at Object.<anonymous> (src/__tests__/business-logic/fraud.detector.test.ts:1:1)

FAIL src/__tests__/setupTests.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/setup.ts
  ‚óè Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:133:18)
      at node_modules/@jest/core/build/TestScheduler.js:254:19
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL src/__tests__/errorHandler.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../utils/errors.js' from 'src/middleware/errorHandler.ts'

    Require stack:
      src/middleware/errorHandler.ts
      src/__tests__/errorHandler.test.ts

    [0m [90m 1 |[39m [36mimport[39m { [33mRequest[39m[33m,[39m [33mResponse[39m[33m,[39m [33mNextFunction[39m } [36mfrom[39m [32m'express'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 2 |[39m [36mimport[39m { [33mApiError[39m } [36mfrom[39m [32m'../utils/errors.js'[39m[33m;[39m
     [90m   |[39m [31m[1m^[22m[39m
     [90m 3 |[39m [36mimport[39m { logger } [36mfrom[39m [32m'../utils/logger.js'[39m[33m;[39m
     [90m 4 |[39m
     [90m 5 |[39m [36mexport[39m [36mconst[39m errorHandler [33m=[39m ([0m

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/middleware/errorHandler.ts:2:1)
      at Object.<anonymous> (src/__tests__/errorHandler.test.ts:13:1)


Test Suites: 22 failed, 6 passed, 28 total
Tests:       110 failed, 2 skipped, 67 passed, 179 total
Snapshots:   0 total
Time:        17.019 s
Ran all test suites.
