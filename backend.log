
> accubooks-enterprise@1.0.0 start:dev
> cross-env NODE_ENV=development nodemon --exec tsx server/index.ts

[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: ts,json[39m
[32m[nodemon] starting `tsx server/index.ts`[39m
[dotenv@17.2.3] injecting env (131) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
Connecting to Redis at: localhost port: 6379
[2026-02-02T21:27:22.045Z] INFO: Stripe initialized 
‚ö†Ô∏è  Environment variable warnings:
   - Recommended variable OWNER_EMAIL is not set
   - Recommended variable REDIS_PASSWORD is not set
‚úÖ Environment variables validated successfully
üìã Environment: development
üìã Database: localhost:5432/chronaworkflow
üìã Frontend URL: http://localhost:3000
üìã Server: localhost:5000
‚ö†Ô∏è  Database connection failed: connect ECONNREFUSED 127.0.0.1:5432
‚ö†Ô∏è  Server will start in degraded mode. Database-dependent routes will return 503.
‚ö†Ô∏è  Starting server without database connection
‚ö†Ô∏è  Database error: connect ECONNREFUSED 127.0.0.1:5432
Redis connection error: connect ECONNREFUSED 127.0.0.1:6379
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
‚ö†Ô∏è  Redis unavailable: Connection is closed.
‚ö†Ô∏è  Job queues will be disabled. Backend will continue without background jobs.
Redis connection error: connect ECONNREFUSED 127.0.0.1:6379
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Redis connection error: connect ECONNREFUSED 127.0.0.1:6379
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
üü° Registered high-risk route: POST /api/customers [createCustomer] (HIGH)
üü° Registered high-risk route: PATCH /api/customers/:id [updateCustomer] (HIGH)
‚úì Registered financial route: POST /api/payments [createPayment]
‚úì Registered financial route: POST /api/bank-transactions/import [importBankTransactions]
‚úì Registered financial route: POST /api/bank-transactions/:id/reconcile [reconcileBankTransaction]
üî¥ Registered high-risk route: POST /api/payroll/employees [createEmployee] (CRITICAL)
‚úì Registered financial route: PATCH /api/payroll/employees/:id [updateEmployee]
‚úì Registered financial route: POST /api/payroll/deductions [createDeduction]
‚úì Registered financial route: POST /api/payroll/employee-deductions [createEmployeeDeduction]
‚úì Registered financial route: POST /api/payroll/periods [createPayrollPeriod]
‚úì Registered financial route: POST /api/payroll/time-entries [createTimeEntry]
‚úì Registered financial route: POST /api/payroll/time-entries/:id/approve [approveTimeEntry]
‚úì Registered financial route: POST /api/payroll/pay-runs [createPayRun]
‚úì Registered financial route: PATCH /api/payroll/pay-runs/:id/status [updatePayRunStatus]
‚úì Registered financial route: POST /api/payroll/tax-forms [createTaxForm]
üü° Registered high-risk route: POST /api/inventory/items [createInventoryItem] (HIGH)
üü° Registered high-risk route: PATCH /api/inventory/items/:id [updateInventoryItem] (HIGH)
‚úì Registered financial route: PATCH /api/inventory/items/:id/quantity [updateInventoryQuantity]
‚úì Registered financial route: POST /api/inventory/purchase-orders [createPurchaseOrder]
‚úì Registered financial route: PATCH /api/inventory/purchase-orders/:id/status [updatePurchaseOrderStatus]
‚úì Registered financial route: POST /api/inventory/adjustments [createInventoryAdjustment]
‚úÖ API routes registered successfully
 AccuBooks server running on http://localhost:5000
Environment: development
Startup duration: 602ms
Redis connection error: connect ECONNREFUSED 127.0.0.1:6379
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
‚ö†Ô∏è  Redis connection failed after 3 attempts. Job queues will be disabled.
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 6379
}
[2026-02-02T21:27:24.871Z] WARN: Redis connection closed. Job queues disabled. 
[2026-02-02T21:27:24.873Z] WARN: Redis not available. Skipping job queue initialization. 
{"level":"info","component":"server.http","message":"request","data":{"requestId":"cf53ab09-9911-4375-87ed-18d7ab469f39","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":6},"timestamp":"2026-02-02T21:27:25.670Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"1396d96e-d2b7-4f7f-90ad-8ad5bc46319d","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:26.709Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"e0b50fc2-5f34-4942-bf1e-438b26868c64","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:26.996Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"b0963dc1-6a42-4461-b485-d74723545872","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:28.037Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"bd45a414-2b36-4ed3-8540-ed1a3fe8feae","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:29.074Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"e494eaec-4cd1-408f-8099-2248846c577e","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:30.120Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"01e4f9b5-7b6b-476a-91cf-02b495f9bdc8","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:31.145Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"de43aa2c-66c5-4589-94e4-55f286914fea","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:32.182Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"a9e1075a-a11d-45ac-a500-181d8fa9cb99","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:33.214Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"e0dad9bc-01da-4c19-9947-990166b724ab","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:34.241Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"daf15a4c-d432-4f0c-b900-4bad65fcfb8d","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:35.292Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"0f35a9b0-7e04-4140-9fcb-8e01bb62d933","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:36.328Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"2bb6f020-3712-402f-9723-05f5a73b8bcc","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:37.361Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"ff4d6086-00cb-41c7-94f9-4b3519381e3e","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:38.400Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"7c97b7da-bfcc-41c9-8e60-48f0ebc28dee","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:39.439Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"b4305078-6642-4915-ba36-67814431a109","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:40.472Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"af745320-86ae-4485-9392-f605d7abd899","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:41.511Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"c1d9a7c7-eff0-4561-8f60-5e591d3833f1","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:42.548Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"7389873e-f3bb-45d9-9ce9-15d9fd3421e6","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:43.579Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"479ef1c0-bc7e-466e-85cc-361bf96830ba","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:44.608Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"26b53781-7c29-4adf-95aa-f9efd8458ca3","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:45.651Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"f5d41f60-d82c-4bd0-901c-326d49e9c2b1","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:46.692Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"a1d17f02-69e9-40e0-9630-711c0f949345","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:47.729Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"c7715c35-014e-45ea-9bc4-de4a5d8bf7fd","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:48.767Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"1e33daf8-ca18-415c-9fbe-34df38160c25","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:49.806Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"ed4164d3-c7dc-48c3-b483-01b264e6fd1a","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:50.847Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"c5ee8623-9a47-45d4-8f43-72476da2c446","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:51.878Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"28f5cd51-3fe1-484b-8f10-b98fb82b4f01","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:52.918Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"2d89e838-f043-4799-80fa-985ff87494b9","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":2},"timestamp":"2026-02-02T21:27:53.957Z","environment":"development"}
{"level":"info","component":"server.http","message":"request","data":{"requestId":"de30a766-72e5-4d5d-a113-823361dbcfd5","method":"GET","path":"/api/monitoring/health","statusCode":401,"durationMs":1},"timestamp":"2026-02-02T21:27:54.998Z","environment":"development"}
